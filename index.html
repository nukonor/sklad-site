<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>–°–∫–ª–∞–¥ v248</title><style>
:root{--bg:#f4f7f9;--c:#fff;--p:#4e73df;--d:#e74a3b;--s:#1cc88a;--t:#000;--b:#bbb}body{font-family:sans-serif;background:var(--bg);margin:0;padding:5px;padding-bottom:80px}.dash-grid{display:flex;flex-direction:column;gap:5px;max-width:500px;margin:0 auto}.dash-item{background:#fff;border-radius:8px;padding:18px;text-align:center;box-shadow:0 1px 3px rgba(0,0,0,0.1);border:1px solid var(--b);font-weight:700;color:var(--p);text-transform:uppercase;font-size:13px}.card{background:#fff;border-radius:10px;padding:10px;margin-bottom:5px;border:1px solid var(--b);position:relative}.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center;padding:5px}.modal-box{background:#fff;width:100%;max-width:380px;border-radius:12px;max-height:92vh;display:flex;flex-direction:column}.modal-body{overflow-y:auto;padding:15px}input,select{width:100%;padding:10px;margin:4px 0;border:1px solid var(--b);border-radius:6px;font-size:16px;box-sizing:border-box;color:#000;font-weight:600}.btn-main{background:var(--p);color:#fff;border:none;width:100%;padding:14px;font-size:13px;font-weight:700;border-radius:8px;margin:2px 0;text-transform:uppercase}.bottom-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:#fff;grid-template-columns:1fr 1fr;gap:5px;padding:8px;border-top:1px solid var(--b);z-index:900}body.nav-active .bottom-nav{display:grid}.folder{background:#eee;padding:10px;border-radius:6px;margin-bottom:3px;font-weight:700;cursor:pointer;display:flex;justify-content:space-between;color:var(--p);font-size:13px}.f-content{display:none;padding-left:8px;border-left:2px solid var(--p);margin-left:4px}.report-line{display:flex;justify-content:space-between;padding:2px 0;font-size:13px;border-bottom:1px solid #f2f2f2}.item-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px}.item-card{background:#fff;border:1.5px solid #000;border-radius:6px;padding:5px 2px;text-align:center;position:relative}.item-title{font-size:11px;font-weight:900;text-transform:uppercase;margin-bottom:2px;color:#000;line-height:1.1;height:24px;overflow:hidden}.item-qty{font-size:14px;font-weight:900;color:var(--p);margin-bottom:3px}.tab-btn{padding:10px;border:1px solid var(--p);background:#fff;color:var(--p);font-weight:700;font-size:11px;border-radius:6px;cursor:pointer}.tab-btn.active{background:var(--p);color:#fff}.history-btn{border:none;background:#f0f0f0;padding:4px 0;border-radius:3px;font-size:10px;font-weight:700;color:var(--p);width:45%;display:inline-block}.corr-btn{border:none;background:#eef2ff;padding:4px 0;border-radius:3px;font-size:10px;font-weight:700;color:var(--s);width:45%;display:inline-block}.alarm{background:#ff0000!important;animation:blnk 1.5s linear infinite}.alarm div{color:#fff!important}@keyframes blnk{50%{opacity:.6}}
</style></head><body>
<div id="uS" style="font-size:10px;text-align:center;margin-bottom:5px">...</div><div id="act"></div><div id="cnt"></div>
<div class="bottom-nav"><button class="btn-main" style="background:#555" onclick="renderHome()">–ú–ï–ù–Æ</button><button class="btn-main" style="background:#888" onclick="goBack()">–ù–ê–ó–ê–î</button></div>
<div id="mdl" class="modal"><div class="modal-box"><div style="display:flex;justify-content:space-between;padding:12px;border-bottom:1px solid #eee"><h4 id="mT" style="margin:0"></h4><button onclick="closeModal()" style="border:none;background:none;font-size:20px">‚úï</button></div><div id="mB" class="modal-body"></div></div></div>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script>
const cfg={apiKey:"AIzaSyAya0CSXtG3Fh4GzJ2bV7AJ0BaYEcTXK9Q",databaseURL:"https://myproductionapp-bd872-default-rtdb.firebaseio.com",projectId:"myproductionapp-bd872"};
firebase.initializeApp(cfg);const db=firebase.database(),auth=firebase.auth();let cur='Home',data={},aId=null,archSub='';
const bP=["–ê—Ä–Ω–∞—É—Ç–∫–∞","–ê—Ä—Ç–µ–∫","–ë–∞—Å–º–∞—Ç–∏ –≥","–ë–∞—Å–º–∞—Ç–∏ –∫","–ë—É–ª–≥—É—Ä","–ì–æ—Ä–æ—Ö","–ì—Ä–µ—á–∫–∞","–ö—É–∫—É—Ä—É–∑–∞","–ö—É–∫.–º—É–∫–∞","–ö—É—Å –∫—É—Å","–ö—É—Ç—è","–ú–∞–Ω–∫–∞","–ù—É—Ç","–ü–µ—Ä–ª–æ–≤–∫–∞","–ü—à–µ–Ω–∏—á–∫–∞","–ü—à–æ–Ω–æ","–†–∏—Å –¥–ª","–†–∏—Å –∫—Ä","–†–∏—Å –ø—Ä","–•–ª–æ–ø—å—è","–ß–µ—á–µ–≤–∏—Ü–∞","–Ø—á–∫–∞"],szs=["300√ó400","370√ó500","400√ó500","420√ó550"],mths=["–Ø–Ω–≤–∞—Ä—å","–§–µ–≤—Ä–∞–ª—å","–ú–∞—Ä—Ç","–ê–ø—Ä–µ–ª—å","–ú–∞–π","–ò—é–Ω—å","–ò—é–ª—å","–ê–≤–≥—É—Å—Ç","–°–µ–Ω—Ç—è–±—Ä—å","–û–∫—Ç—è–±—Ä—å","–ù–æ—è–±—Ä—å","–î–µ–∫–∞–±—Ä—å"];
const fd=i=>i?i.split('T')[0].split('-').reverse().join('.'):'';const closeModal=()=>{document.getElementById('mdl').style.display='none';aId=null};const toggleF=id=>{const e=document.getElementById(id);e.style.display=e.style.display==='block'?'none':'block'};
const gP=(cat)=>{const s=new Set(bP);const dbK=(cat==='WeightStock')?'WeightStock':'–ì–æ—Ç–æ–≤–∞—è';if(data[dbK])Object.values(data[dbK]).forEach(v=>s.add(v.name));return Array.from(s).sort();};
const gS=()=>{const s=new Set();if(data.ArchIncoming)Object.values(data.ArchIncoming).forEach(v=>s.add(v.supplier));return Array.from(s).sort();};
const gCl=()=>{const s=new Set();if(data.ArchInvoices)Object.values(data.ArchInvoices).forEach(v=>s.add(v.client));return Array.from(s).sort();};
function renderHome(){cur='Home';document.body.classList.remove('nav-active');document.getElementById('cnt').innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('StockRoot')">–°–∫–ª–∞–¥</div><div class="dash-item" onclick="setCat('ProdSub')">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</div><div class="dash-item" onclick="setCat('PackSub')">–£–ø–∞–∫–æ–≤–∫–∞</div><div class="dash-item" onclick="openModal('auth')" style="color:#aaa">–í—Ö–æ–¥</div></div>`;document.getElementById('act').innerHTML='';}
function goBack(){const m={'GP_Root':'StockRoot','StockList':'GP_Root','WeightStock':'GP_Root','Invoices':'StockRoot','ArchSubIn':'Invoices','ArchSubOut':'Invoices','InvoicesDate':'ArchSub','InvoicesClient':'ArchSub','–§–∞—Å–æ–≤–∫–∞':'ProdSub','Kruporushka':'ProdSub','Vibrostol':'ProdSub','ZSHM':'ProdSub','–ü–ª–µ–Ω–∫–∞':'PackSub','–ü–∞–∫–µ—Ç—ã':'PackSub','–°–∫–æ—Ç—á':'PackSub'};let next=m[cur]||'Home';if(cur==='InvoicesDate'||cur==='InvoicesClient')next=archSub==='In'?'ArchSubIn':'ArchSubOut';setCat(next);}
function setCat(c){cur=c;document.body.classList.add('nav-active');const a=document.getElementById('act'),ct=document.getElementById('cnt');a.innerHTML='';if(c==='Home'){renderHome();return}if(c==='StockRoot'){a.innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:10px"><button class="btn-main" style="background:var(--s)" onclick="openModal('inc')">–ü—Ä–∏—Ö–æ–¥</button><button class="btn-main" style="background:var(--d)" onclick="openModal('ship')">–û—Ç–≥—Ä—É–∑–∫–∞</button></div>`;ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('GP_Root')">–ì–æ—Ç–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è</div><div class="dash-item" onclick="setCat('Invoices')">–ê—Ä—Ö–∏–≤ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö</div></div>`;}else if(c==='GP_Root'){ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('StockList')">–§–∞—Å–æ–≤–∫–∞</div><div class="dash-item" onclick="setCat('WeightStock')">–í–µ—Å–æ–≤–∞—è</div></div>`;}else if(c==='Invoices'){ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('ArchSubIn')">–ü—Ä–∏—Ö–æ–¥—ã</div><div class="dash-item" onclick="setCat('ArchSubOut')">–û—Ç–≥—Ä—É–∑–∫–∏</div></div>`;}else if(c==='ArchSubIn'||c==='ArchSubOut'){archSub=c==='ArchSubIn'?'In':'Out';ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('InvoicesDate')">–ü–æ –¥–∞—Ç–∞–º</div><div class="dash-item" onclick="setCat('InvoicesClient')">–ü–æ –∏–º–µ–Ω–∞–º</div></div>`;}else if(c==='ProdSub')ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('–§–∞—Å–æ–≤–∫–∞')">–¶–µ—Ö —Ñ–∞—Å–æ–≤–∫–∏</div><div class="dash-item" onclick="setCat('Kruporushka')">–ö—Ä—É–ø–æ—Ä—É—à–∫–∞</div><div class="dash-item" onclick="setCat('Vibrostol')">–í–∏–±—Ä–æ—Å—Ç–æ–ª</div><div class="dash-item" onclick="setCat('ZSHM')">–ó–®–ú</div></div>`;else if(c==='PackSub'){a.innerHTML=`<button class="btn-main" style="background:var(--s)" onclick="openModal('addMatPack')">–ü—Ä–∏—Ö–æ–¥ —É–ø–∞–∫–æ–≤–∫–∏</button>`;ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('–ü–ª–µ–Ω–∫–∞')">–ü–ª–µ–Ω–∫–∞</div><div class="dash-item" onclick="setCat('–ü–∞–∫–µ—Ç—ã')">–ü–∞–∫–µ—Ç—ã</div><div class="dash-item" onclick="setCat('–°–∫–æ—Ç—á')">–°–∫–æ—Ç—á</div></div>`;}else if(c==='–§–∞—Å–æ–≤–∫–∞')a.innerHTML=`<button class="btn-main" onclick="openModal('fas')">+ –ó–∞–ø–∏—Å—å</button>`;loadData();}
function loadData(){db.ref('inventory').on('value',s=>{data=s.val()||{};const c=document.getElementById('cnt');if(!c||['Home','PackSub','ProdSub','StockRoot','GP_Root','Invoices','ArchSubIn','ArchSubOut'].includes(cur))return;if(cur==='InvoicesDate')rInvD(c);else if(cur==='InvoicesClient')rInvC(c);else if(cur==='–§–∞—Å–æ–≤–∫–∞')rFas(c);else if(cur==='StockList')rWH(c);else if(cur==='WeightStock')rWgh(c);else rGen(c);});}
function rWH(c){const t={};gP('–ì–æ—Ç–æ–≤–∞—è').forEach(p=>t[p]=0);if(data.–ì–æ—Ç–æ–≤–∞—è)Object.values(data.–ì–æ—Ç–æ–≤–∞—è).forEach(v=>t[v.name]+=v.amount);let h='<div class="item-grid">';Object.keys(t).sort().forEach(n=>{const l=t[n]<10;h+=`<div class="item-card ${l?'alarm':''}"><div class="item-title">${n}</div><div class="item-qty">${Math.round(t[n])}</div><button class="history-btn" onclick="showH('–ì–æ—Ç–æ–≤–∞—è','${n}')">üìú</button> <button class="corr-btn" onclick="openModal('corr','–ì–æ—Ç–æ–≤–∞—è|${n}')">¬±</button></div>`;});c.innerHTML=h+'</div>';}
function rWgh(c){const t={};gP('WeightStock').forEach(p=>t[p]=0);if(data.WeightStock)Object.values(data.WeightStock).forEach(v=>t[v.name]+=v.amount);let h='<div class="item-grid">';Object.keys(t).sort().forEach(n=>{h+=`<div class="item-card"><div class="item-title">${n}</div><div class="item-qty">${Math.round(t[n])}</div><button class="history-btn" onclick="showH('WeightStock','${n}')">üìú</button> <button class="corr-btn" onclick="openModal('corr','WeightStock|${n}')">¬±</button></div>`;});c.innerHTML=h+'</div>';}
function rGen(c){const d=data[cur]||{},t={};Object.values(d).forEach(v=>{let k=v.size||v.name;if(k)t[k]=(t[k]||0)+v.amount});if(cur==='–ü–∞–∫–µ—Ç—ã' && data.–§–∞—Å–æ–≤–∫–∞){Object.values(data.–§–∞—Å–æ–≤–∫–∞).forEach(v=>{if(t[v.size]!==undefined){let k=(v.name==="–ö—É—Ç—è")?0.051:0.102;t[v.size]-=(v.vyhod*k);}});}let h='<div class="item-grid">';Object.keys(t).sort().forEach(k=>{let l=(cur==='–ü–∞–∫–µ—Ç—ã'&&t[k]<3000)||(cur==='–ü–ª–µ–Ω–∫–∞'&&t[k]<50);h+=`<div class="item-card ${l?'alarm':''}"><div class="item-title">${k}</div><div class="item-qty">${Math.round(t[k])}</div><button class="history-btn" style="width:90%" onclick="showH('${cur}','${k}')">üìú –ò–°–¢–û–†–ò–Ø</button></div>`;});c.innerHTML=h+'</div>';}
function rFas(c){let h='';if(data.–§–∞—Å–æ–≤–∫–∞){Object.entries(data.–§–∞—Å–æ–≤–∫–∞).sort((a,b)=>b[1].date.localeCompare(a[1].date)).forEach(([id,v])=>{const k=(v.name==="–ö—É—Ç—è")?0.051:0.102,pk=Math.round(v.vyhod*k),pl=Math.abs((v.vzial||0)-(v.ostatok||0)).toFixed(1);h+=`<div class="card"><b>${v.name.toUpperCase()}</b> [${fd(v.date)}]<div class="report-line"><span>–°—ã—Ä—å–µ:</span><b>${v.prihod}–∫–≥</b></div><div class="report-line"><span>–í—ã—Ö–æ–¥:</span><b>${v.vyhod}—à—Ç</b></div><div class="report-line"><span>–ü–∞–∫–µ—Ç—ã:</span><b>${v.size} [${pk}—à—Ç]</b></div><div class="report-line"><span>–ü–ª–µ–Ω–∫–∞:</span><b>${pl}–∫–≥</b></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:5px;margin-top:8px"><button class="btn-main" style="padding:6px;font-size:10px" onclick="openModal('fas','${id}')">–ü–†–ê–í–ò–¢–¨</button><button class="btn-main" style="background:var(--d);padding:6px;font-size:10px" onclick="delRec('–§–∞—Å–æ–≤–∫–∞','${id}')">–£–î–ê–õ–ò–¢–¨</button></div></div>`;});}c.innerHTML=h||'–ó–∞–ø–∏—Å–µ–π –Ω–µ—Ç';}
function rInvD(c){const dbK=archSub==='In'?'ArchIncoming':'ArchInvoices',d=data[dbK]||{},t={};Object.entries(d).forEach(([id,v])=>{const dt=new Date(v.date),y=dt.getFullYear(),m=dt.getMonth(),dy=dt.getDate();if(!t[y])t[y]={c:0,m:{}};if(!t[y].m[m])t[y].m[m]={c:0,d:{}};if(!t[y].m[m].d[dy])t[y].m[m].d[dy]=[];t[y].m[m].d[dy].push({...v,id});t[y].c++;t[y].m[m].c++;});let h='';Object.keys(t).sort((a,b)=>b-a).forEach(y=>{h+=`<div class="folder" onclick="toggleF('y${y}')"><span>${y}</span><span>[${t[y].c}]</span></div><div id="y${y}" class="f-content">`;Object.keys(t[y].m).sort((a,b)=>b-a).forEach(m=>{h+=`<div class="folder" onclick="toggleF('m${y}${m}')"><span>${mths[m]}</span><span>[${t[y].m[m].c}]</span></div><div id="m${y}${m}" class="f-content">`;Object.keys(t[y].m[m].d).sort((a,b)=>b-a).forEach(dy=>{h+=`<div class="folder" onclick="toggleF('d${y}${m}${dy}')"><span>${dy}</span><span>[${t[y].m[m].d[dy].length}]</span></div><div id="d${y}${m}${dy}" class="f-content">`;t[y].m[m].d[dy].reverse().forEach(v=>h+=`<div class="card" onclick="openModal('vInv','${v.id}')">${v.num}-${v.client||v.supplier}</div>`);h+=`</div>`;});h+=`</div>`;});h+=`</div>`;});c.innerHTML=h||'–ü—É—Å—Ç–æ';}
function rInvC(c){const dbK=archSub==='In'?'ArchIncoming':'ArchInvoices',d=data[dbK]||{},cl={};Object.entries(d).forEach(([id,v])=>{const name=v.client||v.supplier;if(!cl[name])cl[name]=[];cl[name].push({...v,id});});let h='';Object.keys(cl).sort().forEach((n,i)=>{h+=`<div class="folder" onclick="toggleF('cl${i}')"><span>${n}</span><span>[${cl[n].length}]</span></div><div id="cl${i}" class="f-content">`;cl[n].sort((a,b)=>b.date.localeCompare(a.date)).forEach(v=>h+=`<div class="card" onclick="openModal('vInv','${v.id}')">${v.num}-${fd(v.date)}</div>`);h+=`</div>`;});c.innerHTML=h||'–ü—É—Å—Ç–æ';}
function toggleShipTab(tab){document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');document.getElementById('shipGridF').style.display=tab==='F'?'grid':'none';document.getElementById('shipGridW').style.display=tab==='W'?'grid':'none';}
function openModal(t,id){const ti=document.getElementById('mT'),b=document.getElementById('mB');if(!id)aId=null;else aId=id;if(t==='inc'){ti.innerText='–ü—Ä–∏—Ö–æ–¥';b.innerHTML=`–°–∫–ª–∞–¥:<select id="iDst" onchange="const s=document.getElementById('iN');s.innerHTML='<option value=>–í—ã–±—Ä–∞—Ç—å...</option>'+gP(this.value).map(p=>'<option value='+p+'>'+p+'</option>').join('')+'<option value=NEW>+ –ù–û–í–´–ô</option>'"><option value="WeightStock">–í–ï–°–û–í–ê–Ø</option><option value="–ì–æ—Ç–æ–≤–∞—è">–§–ê–°–û–í–ö–ê</option></select>–î–∞—Ç–∞:<input type="date" id="iD" value="${new Date().toISOString().split('T')[0]}">–ü—Ä–æ–¥—É–∫—Ç:<select id="iN" onchange="const n=document.getElementById('iNn');n.style.display=this.value==='NEW'?'block':'none'"><option value="">–í—ã–±—Ä–∞—Ç—å...</option>${gP('WeightStock').map(p=>`<option value="${p}">${p}</option>`).join('')}<option value="NEW">+ –ù–û–í–´–ô</option></select><input type="text" id="iNn" placeholder="–ò–º—è –ø—Ä–æ–¥—É–∫—Ç–∞" style="display:none">–ü–æ—Å—Ç–∞–≤—â–∏–∫:<select id="iS" onchange="const n=document.getElementById('iSn');n.style.display=this.value==='NEW'?'block':'none'"><option value="">–í—ã–±—Ä–∞—Ç—å...</option>${gS().map(s=>`<option value="${s}">${s}</option>`).join('')}<option value="NEW">+ –ù–û–í–´–ô</option></select><input type="text" id="iSn" placeholder="–ò–º—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞" style="display:none">–ï–¥.–∏–∑–º:<select id="iU"><option value="–∫–≥">–∫–≥</option><option value="—à—Ç">—à—Ç</option></select>–ö–æ–ª-–≤–æ:<input type="number" id="iA" placeholder="0.00">‚Ññ –ù–∞–∫–ª:<input type="text" id="iNum" placeholder="‚Ññ –Ω–∞–∫–ª–∞–¥–Ω–æ–π"><button class="btn-main" onclick="sInc()">–ó–ê–ü–ò–°–ê–¢–¨</button>`;}else if(t==='addMatPack'){ti.innerText='–ü—Ä–∏—Ö–æ–¥ –£–ø–∞–∫–æ–≤–∫–∏';b.innerHTML=`–†–∞–∑–¥–µ–ª:<select id="mCat" onchange="const s=document.getElementById('mS');if(this.value==='–ü–∞–∫–µ—Ç—ã')s.innerHTML='${szs.map(x=>`<option>${x}</option>`).join('')}';else if(this.value==='–ü–ª–µ–Ω–∫–∞')s.innerHTML='${bP.map(x=>`<option>${x}</option>`).join('')}';else s.innerHTML='<option value=–°–∫–æ—Ç—á>–°–∫–æ—Ç—á</option>'"><option value="–ü–∞–∫–µ—Ç—ã">–ü–∞–∫–µ—Ç—ã</option><option value="–ü–ª–µ–Ω–∫–∞">–ü–ª–µ–Ω–∫–∞</option><option value="–°–∫–æ—Ç—á">–°–∫–æ—Ç—á</option></select>–¢–∏–ø:<select id="mS">${szs.map(x=>`<option>${x}</option>`).join('')}</select>–ö–æ–ª-–≤–æ:<input type="number" id="mA"><button class="btn-main" onclick="sMatP()">–û–ö</button>`;}else if(t==='corr'){const [cat,name]=id.split('|');ti.innerText='–ö–æ—Ä—Ä–µ–∫—Ü–∏—è: '+name;b.innerHTML=`–ö–æ–ª-–≤–æ (+/-):<input type="number" id="cA" placeholder="–ù–∞–ø—Ä: -10">–ü—Ä–∏—á–∏–Ω–∞:<input type="text" id="cR" placeholder="–ë—Ä–∞–∫/–°–ø–∏—Å–∞–Ω–∏–µ"><button class="btn-main" onclick="sCorr('${cat}','${name}')">–û–ö</button>`;}else if(t==='ship'){const v=id?data.ArchInvoices[id]:{date:new Date().toISOString().split('T')[0],num:'',client:'',items:[]};ti.innerText=id?'–ü—Ä–∞–≤–∫–∞':'–û—Ç–≥—Ä—É–∑–∫–∞';b.innerHTML=`–î–∞—Ç–∞:<input type="date" id="sD" value="${v.date.split('T')[0]}">–ù–æ–º–µ—Ä:<input type="text" id="sN" placeholder="‚Ññ" value="${v.num}">–ö–ª–∏–µ–Ω—Ç:<select id="sCS" onchange="const n=document.getElementById('sCN');n.style.display=this.value==='NEW'?'block':'none'"><option value="">–í—ã–±—Ä–∞—Ç—å...</option>${gCl().map(c=>`<option value="${c}" ${v.client===c?'selected':''}>${c}</option>`).join('')}<option value="NEW">+ –ù–û–í–´–ô</option></select><input type="text" id="sCN" placeholder="–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç" style="display:none"><div style="display:grid;grid-template-columns:1fr 1fr;gap:5px;margin:10px 0"><button class="tab-btn active" onclick="toggleShipTab('F')">–§–ê–°–û–í–ö–ê (–®–¢)</button><button class="tab-btn" onclick="toggleShipTab('W')">–í–ï–°–û–í–ê–Ø (–ö–ì)</button></div><div id="shipGridF" class="item-grid"><div class="item-card" style="border-color:var(--s);grid-column: span 3"><input type="text" id="newPF" placeholder="+ –ù–û–í–´–ô –¢–û–í–ê–† (–§–ê–°–û–í–ö–ê)" style="margin:2px;font-size:10px"><input type="number" id="newAF" placeholder="–ö–æ–ª-–≤–æ —à—Ç" style="margin:2px;font-size:10px"></div>${gP('–ì–æ—Ç–æ–≤–∞—è').map(p=>{let a='';if(id && v.items){const f=v.items.find(it=>it.startsWith(p+':'));if(f)a=f.split(': ')[1].replace('—à—Ç','').replace('–∫–≥','');}return `<div class="item-card"><label class="item-title">${p}</label><input type="number" class="s-in" data-cat="–ì–æ—Ç–æ–≤–∞—è" data-p="${p}" value="${a}" style="width:90%;text-align:center;border:1px solid #000;font-weight:900;font-size:16px;background:#fff"></div>`}).join('')}</div><div id="shipGridW" class="item-grid" style="display:none"><div class="item-card" style="border-color:var(--s);grid-column: span 3"><input type="text" id="newPW" placeholder="+ –ù–û–í–´–ô –¢–û–í–ê–† (–í–ï–°–û–í–ê–Ø)" style="margin:2px;font-size:10px"><input type="number" id="newAW" placeholder="–ö–æ–ª-–≤–æ –∫–≥" style="margin:2px;font-size:10px"></div>${gP('WeightStock').map(p=>{let a='';if(id && v.items){const f=v.items.find(it=>it.startsWith(p+':'));if(f)a=f.split(': ')[1].replace('–∫–≥','').replace('—à—Ç','');}return `<div class="item-card"><label class="item-title">${p}</label><input type="number" class="s-in" data-cat="WeightStock" data-p="${p}" value="${a}" style="width:90%;text-align:center;border:1px solid #000;font-weight:900;font-size:16px;background:#fff"></div>`}).join('')}</div><button class="btn-main" onclick="sShip()">${id?'–û–ë–ù–û–í–ò–¢–¨':'–°–û–•–†–ê–ù–ò–¢–¨'}</button>`;}else if(t==='fas'){const v=id?data.–§–∞—Å–æ–≤–∫–∞[id]:{date:new Date().toISOString().split('T')[0],name:'',size:'',vyhod:'',prihod:'',vzial:'',ostatok:''};ti.innerText=id?'–ü—Ä–∞–≤–∫–∞':'–§–∞—Å–æ–≤–∫–∞';b.innerHTML=`–î–∞—Ç–∞:<input type="date" id="fD" value="${v.date.split('T')[0]}">–ö—Ä—É–ø–∞:<select id="fN">${gP('–ì–æ—Ç–æ–≤–∞—è').map(p=>`<option ${v.name===p?'selected':''}>${p}</option>`).join('')}</select>–ü–∞–∫–µ—Ç:<select id="fS">${szs.map(s=>`<option ${v.size===s?'selected':''}>${s}</option>`).join('')}</select><input type="number" id="fP" placeholder="–°—ã—Ä—å–µ –∫–≥" value="${v.prihod}"><input type="number" id="fV" placeholder="–í—ã—Ö–æ–¥ —à—Ç" value="${v.vyhod}"><input type="number" id="fVz" placeholder="–í–∑—è–ª –ø–ª–µ–Ω–∫–∏" value="${v.vzial}"><input type="number" id="fOs" placeholder="–û—Å—Ç–∞—Ç–æ–∫ –ø–ª–µ–Ω–∫–∏" value="${v.ostatok}"><button class="btn-main" onclick="sFas()">${id?'–û–ë–ù–û–í–ò–¢–¨':'–°–û–•–†–ê–ù–ò–¢–¨'}</button>`;}else if(t==='vInv'){const dbK=archSub==='In'?'ArchIncoming':'ArchInvoices',v=data[dbK][id];ti.innerText='–ù–∞–∫–ª–∞–¥–Ω–∞—è';b.innerHTML=`<b>${v.client||v.supplier}</b> (${fd(v.date)})<br>‚Ññ ${v.num}<div style="background:#eee;padding:8px;margin-top:10px;font-size:12px">${v.items?v.items.join('<br>'):(v.name+': '+v.amount+v.unit)}</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:5px;margin-top:10px"><button class="btn-main" onclick="openModal('ship','${id}')">–ü–†–ê–í–ò–¢–¨</button><button class="btn-main" style="background:var(--d)" onclick="delRec('${dbK}','${id}')">–£–î–ê–õ–ò–¢–¨</button></div>`;}else if(t==='auth'){ti.innerText='–í—Ö–æ–¥';b.innerHTML=`<input type="email" id="lE" value="nukonor@gmail.com"><input type="password" id="lP"><button class="btn-main" onclick="login()">–í–•–û–î</button>`;}document.getElementById('mdl').style.display='flex';}
async function sShip(){const d=document.getElementById('sD').value,n=document.getElementById('sN').value,s=document.getElementById('sCS').value,nw=document.getElementById('sCN').value,cl=s==='NEW'?nw:s,it=[];document.querySelectorAll('.s-in').forEach(async i=>{const a=parseFloat(i.value);if(a>0){const prod=i.dataset.p,cat=i.dataset.cat;const unit=cat==='WeightStock'?'–∫–≥':'—à—Ç';it.push(prod+': '+a+unit);await db.ref('inventory/'+cat).push({name:prod,amount:-a,date:d+"T12:00:00Z",note:'–û—Ç–≥—Ä—É–∑–∫–∞: '+cl+' (‚Ññ'+n+')'});}});const nPF=document.getElementById('newPF').value,nAF=parseFloat(document.getElementById('newAF').value);if(nPF && nAF){it.push(nPF+': '+nAF+'—à—Ç');await db.ref('inventory/–ì–æ—Ç–æ–≤–∞—è').push({name:nPF,amount:-nAF,date:d+"T12:00:00Z",note:'–û—Ç–≥—Ä—É–∑–∫–∞ (–Ω–æ–≤—ã–π): '+cl});}const nPW=document.getElementById('newPW').value,nAW=parseFloat(document.getElementById('newAW').value);if(nPW && nAW){it.push(nPW+': '+nAW+'–∫–≥');await db.ref('inventory/WeightStock').push({name:nPW,amount:-nAW,date:d+"T12:00:00Z",note:'–û—Ç–≥—Ä—É–∑–∫–∞ (–Ω–æ–≤—ã–π): '+cl});}if(cl){const r=aId?db.ref('inventory/ArchInvoices/'+aId):db.ref('inventory/ArchInvoices').push();await r.set({date:d+"T12:00:00Z",num:n,client:cl,items:it});closeModal();}}
async function sMatP(){const c=document.getElementById('mCat').value,s=document.getElementById('mS').value,a=parseFloat(document.getElementById('mA').value);if(a)await db.ref('inventory/'+c).push({date:new Date().toISOString(),size:s,name:s,amount:a,note:'–ü—Ä–∏—Ö–æ–¥'});closeModal();}
async function sCorr(cat,name){const a=parseFloat(document.getElementById('cA').value),r=document.getElementById('cR').value;if(a){await db.ref('inventory/'+cat).push({date:new Date().toISOString(),name:name,amount:a,note:r||'–ö–æ—Ä—Ä–µ–∫—Ü–∏—è'});closeModal();}}
async function sInc(){const dst=document.getElementById('iDst').value,d=document.getElementById('iD').value,n=document.getElementById('iN').value,nn=document.getElementById('iNn').value,s=document.getElementById('iS').value,sn=document.getElementById('iSn').value,u=document.getElementById('iU').value,a=parseFloat(document.getElementById('iA').value),num=document.getElementById('iNum').value,pr=n==='NEW'?nn:n,su=s==='NEW'?sn:s;if(a&&pr){const r=db.ref('inventory/ArchIncoming').push();await r.set({date:d+"T12:00:00Z",name:pr,supplier:su,amount:a,unit:u,num:num,note:'–ü—Ä–∏—Ö–æ–¥'});await db.ref('inventory/'+dst).push({date:d+"T12:00:00Z",name:pr,amount:a,unit:u,supplier:su,note:num});closeModal();}}
async function sFas(){const d=document.getElementById('fD').value,n=document.getElementById('fN').value,s=document.getElementById('fS').value,v=parseFloat(document.getElementById('fV').value),p=parseFloat(document.getElementById('fP').value),vz=parseFloat(document.getElementById('fVz').value)||0,os=parseFloat(document.getElementById('fOs').value)||0;const r=aId?db.ref('inventory/–§–∞—Å–æ–≤–∫–∞/'+aId):db.ref('inventory/–§–∞—Å–æ–≤–∫–∞').push();await r.set({date:d+"T12:00:00Z",name:n,size:s,vyhod:v,prihod:p,vzial:vz,ostatok:os});await db.ref('inventory/–ì–æ—Ç–æ–≤–∞—è').push({name:n,amount:v,date:d+"T12:00:00Z",note:aId?'–ü—Ä–∞–≤–∫–∞':'–§–∞—Å–æ–≤–∫–∞'});closeModal();}
function showH(c,k){const ti=document.getElementById('mT'),b=document.getElementById('mB');ti.innerText=k;const hist=[];if(data[c])Object.entries(data[c]).filter(([id,v])=>v.size===k||v.name===k).forEach(([id,v])=>{let desc=v.note||'–ó–∞–ø–∏—Å—å';if(v.supplier)desc='–ü—Ä–∏—Ö–æ–¥: '+v.supplier+(v.note?' (‚Ññ'+v.note+')':'');hist.push({d:v.date,n:desc,a:v.amount,id:id,m:true})});if(c==='–ü–∞–∫–µ—Ç—ã' && data.–§–∞—Å–æ–≤–∫–∞){Object.entries(data.–§–∞—Å–æ–≤–∫–∞).filter(([id,v])=>v.size===k).forEach(([id,v])=>{const kf=(v.name==="–ö—É—Ç—è")?0.051:0.102;hist.push({d:v.date,n:'–§–∞—Å–æ–≤–∫–∞: '+v.name,a:-(v.vyhod*kf),id:id,m:false});});}hist.sort((x,y)=>y.d.localeCompare(x.d));let h='<table style="width:100%;font-size:11px;border-collapse:collapse">';hist.forEach(v=>{h+=`<tr style="border-bottom:1px solid #ccc"><td style="padding:6px 0">${fd(v.d)}<br><small style="color:${v.m?'#000':'#666'}">${v.n}</small></td><td style="text-align:right;font-weight:700">${v.a.toFixed(1)}</td><td>${v.m?`<button style="border:none;background:none;color:red" onclick="delRec('${c}','${v.id}')">‚úï</button>`:''}</td></tr>`});b.innerHTML=h+'</table>';document.getElementById('mdl').style.display='flex'}
function delRec(cat,id){if(confirm('–£–¥–∞–ª–∏—Ç—å?')){db.ref(`inventory/${cat}/${id}`).remove();closeModal()}}
async function login(){try{await auth.signInWithEmailAndPassword(document.getElementById('lE').value,document.getElementById('lP').value);closeModal()}catch(e){alert('–û—à–∏–±–∫–∞')}}
auth.onAuthStateChanged(u=>{document.getElementById('uS').innerText=u?u.email.toUpperCase():"–í–•–û–î...";renderHome()});window.onload=renderHome;
</script></body></html>
