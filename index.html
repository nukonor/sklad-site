<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>–°–∫–ª–∞–¥ v323 Calendar</title>
<style>
:root { --bg: #f1f5f9; --p: #4f46e5; --d: #ef4444; --s: #10b981; --t: #1e293b; --w: #fff; }
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 90px; color: var(--t); -webkit-tap-highlight-color: transparent; }
.dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 600px; margin: 0 auto; }
.dash-item { background: var(--w); border-radius: 16px; padding: 18px 10px; text-align: center; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); color: var(--p); font-weight: 700; text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px; border: 1px solid #e2e8f0; transition: 0.1s; }
.dash-item:active { transform: scale(0.97); background: #eef2ff; }
.card { background: var(--w); border-radius: 16px; padding: 14px; margin-bottom: 10px; box-shadow: 0 2px 4px -1px rgba(0,0,0,0.06); border: 1px solid #f1f5f9; position: relative; }
.btn-main { background: var(--p); color: #fff; border: none; width: 100%; padding: 14px; font-size: 13px; font-weight: 700; border-radius: 12px; margin: 5px 0; text-transform: uppercase; box-shadow: 0 4px 10px rgba(79, 70, 229, 0.2); transition: 0.2s; }
.btn-main:active { transform: translateY(1px); box-shadow: none; }

/* –ú–ï–ù–Æ */
.bottom-nav { display: none; position: fixed; bottom: 15px; left: 15px; right: 15px; background: #fff; border-radius: 20px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1); padding: 5px; z-index: 900; grid-template-columns: 1fr 1fr; gap: 5px; border: 1px solid #e2e8f0; }
.bottom-nav button { background: transparent; border: none; padding: 12px; border-radius: 14px; color: #94a3b8; font-weight: 800; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; transition: 0.2s; }
.bottom-nav button.nav-btn-active { background: #eef2ff; color: var(--p); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
body.nav-active .bottom-nav { display: grid; }

input, select { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #cbd5e1; border-radius: 10px; font-size: 16px; box-sizing: border-box; background: #fff; outline: none; font-weight: 600; color: #0f172a; transition: 0.2s; }
input:focus, select:focus { border-color: var(--p); ring: 2px solid var(--p); background: #f8fafc; }
.item-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
.item-card { background: #fff; border-radius: 12px; padding: 10px 4px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; position: relative; }
.item-title { font-size: 10px; font-weight: 800; text-transform: uppercase; color: #64748b; margin-bottom: 4px; height: 24px; overflow: hidden; line-height: 1.1; }
.item-qty { font-size: 15px; font-weight: 900; color: #0f172a; margin-bottom: 4px; }
.modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
.modal-box { background: #fff; width: 92%; max-width: 400px; border-radius: 20px; max-height: 94vh; display: flex; flex-direction: column; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.2); }
.modal-body { overflow-y: auto; padding: 15px; }
.report-line { display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px; border-bottom: 1px dashed #e2e8f0; }
.alarm-blink { background: #fef2f2 !important; border: 1px solid var(--d) !important; animation: blink 1s infinite alternate; }
.alarm-blink * { color: var(--d) !important; }
.history-btn { border: none; background: #e0e7ff; color: var(--p); border-radius: 8px; padding: 8px; font-weight: 700; font-size: 12px; width: 45%; }
.corr-btn { display: none; border: none; background: #fef3c7; color: #d97706; border-radius: 8px; padding: 8px; font-weight: 700; font-size: 12px; width: 45%; margin-top: 4px; }
.show-corr .corr-btn { display: inline-block; }
.hist-pos { color: var(--p) !important; } .hist-neg { color: var(--d) !important; }
.krup-row { display:grid; grid-template-columns: 2fr 1fr 1fr; gap:6px; align-items:center; border-bottom:1px solid #f1f5f9; padding-bottom:8px; margin-bottom:8px; }
.krup-sec { font-size:11px; font-weight:900; color:#64748b; margin-top:12px; text-transform:uppercase; letter-spacing: 1px; }
.tab-group { display: flex; gap: 4px; margin-bottom: 10px; padding: 4px; background: #f1f5f9; border-radius: 12px; }
.tab-btn { flex: 1; padding: 10px 4px; background: transparent; border: none; border-radius: 10px; color: #64748b; font-weight: 700; font-size: 10px; text-transform: uppercase; transition:0.2s }
.tab-btn.active { background: #fff; color: var(--p); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
.ship-sect { display: none; }
.ship-sect.active { display: grid; }
.new-input { display:none; border:2px solid var(--s) !important; }
.clean-cat { font-size:10px; font-weight:900; color:#94a3b8; margin:15px 0 5px; border-bottom:1px solid #eee; padding-bottom:2px; letter-spacing:1px; }

/* –ù–û–í–´–ô –î–ò–ó–ê–ô–ù –ê–†–•–ò–í–ê */
.arch-content { display: none; padding-top: 10px; }
.arch-y-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px; }
.arch-tile-y { background: #3b82f6; color: #fff; padding: 15px; border-radius: 14px; text-align: center; font-weight: 800; font-size: 18px; cursor: pointer; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3); transition: 0.1s; position: relative; }
.arch-tile-y:active { transform: scale(0.98); }
.arch-m-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-bottom: 10px; }
.arch-tile-m { background: #fff; border: 1px solid #e2e8f0; border-radius: 10px; padding: 10px 4px; text-align: center; font-size: 11px; font-weight: 700; color: #475569; cursor: pointer; position: relative; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
.arch-tile-m:active { background: #f8fafc; }
.arch-d-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-bottom: 10px; }
.arch-tile-d { background: #fff; border: 1px solid #cbd5e1; border-radius: 8px; padding: 10px 0; text-align: center; font-size: 14px; font-weight: 800; color: #1e293b; cursor: pointer; position: relative; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
.arch-badge { position: absolute; top: -5px; right: -5px; background: var(--d); color: #fff; font-size: 9px; min-width: 16px; height: 16px; border-radius: 8px; display: flex; align-items: center; justify-content: center; padding: 0 3px; font-weight: 700; box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3); border:1px solid #fff; }
.arch-inv { background: #fff; border-left: 4px solid var(--p); border-radius: 8px; padding: 10px; margin-bottom: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; font-size: 12px; }
.arch-inv b { display: block; font-size: 13px; color: #334155; }
.arch-cl-tile { background: #fff; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 5px; font-weight: 700; display: flex; justify-content: space-between; cursor: pointer; color: #475569; }

@keyframes blink { from { opacity: 1; } to { opacity: 0.7; } }
</style>
</head>
<body>
<div id="uS" style="font-size:10px;text-align:center;margin-bottom:5px;opacity:0.6">–ó–ê–ì–†–£–ó–ö–ê...</div>
<div id="act"></div>
<div id="cnt"></div>
<div class="bottom-nav">
<button id="navM" onclick="renderHome()">–ú–ï–ù–Æ</button>
<button id="navB" onclick="goBack()">–ù–ê–ó–ê–î</button>
</div>
<div id="mdl" class="modal"><div class="modal-box"><div style="display:flex;justify-content:space-between;padding:15px;border-bottom:1px solid #eee"><h4 id="mT" style="margin:0;font-size:16px"></h4><button onclick="closeModal()" style="border:none;background:none;font-size:24px;color:#999">‚úï</button></div><div id="mB" class="modal-body"></div></div></div>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script>
const cfg={apiKey:"AIzaSyAya0CSXtG3Fh4GzJ2bV7AJ0BaYEcTXK9Q",databaseURL:"https://myproductionapp-bd872-default-rtdb.firebaseio.com",projectId:"myproductionapp-bd872"};
if(!firebase.apps.length)firebase.initializeApp(cfg);const db=firebase.database().ref('production'),auth=firebase.auth();let cur='Home',data={},aId=null,archSub='',corrMode=false;
const bP=["–ê—Ä–Ω–∞—É—Ç–∫–∞","–ê—Ä—Ç–µ–∫","–ë–∞—Å–º–∞—Ç–∏ –≥","–ë–∞—Å–º–∞—Ç–∏ –∫","–ë—É–ª–≥—É—Ä","–ì–æ—Ä–æ—Ö","–ì—Ä–µ—á–∫–∞","–ö—É–∫—É—Ä—É–∑–∞","–ö—É–∫.–º—É–∫–∞","–ö—É—Å –∫—É—Å","–ö—É—Ç—è","–ú–∞–Ω–∫–∞","–ù—É—Ç","–ü–µ—Ä–ª–æ–≤–∫–∞","–ü—à–µ–Ω–∏—á–∫–∞","–ü—à–æ–Ω–æ","–†–∏—Å –¥–ª","–†–∏—Å –∫—Ä","–†–∏—Å –ø—Ä","–•–ª–æ–ø—å—è","–ß–µ—á–µ–≤–∏—Ü–∞","–Ø—á–∫–∞"],szs=["300√ó400","370√ó500","400√ó500","420√ó550"],mths=["–Ø–Ω–í","–§–µ–≤","–ú–∞—Ä—Ç","–ê–ø—Ä","–ú–∞–π","–ò—é–Ω—å","–ò—é–ª—å","–ê–≤–≥","–°–µ–Ω—Ç","–û–∫—Ç","–ù–æ—è","–î–µ–∫"];
const fd=i=>{if(!i)return'';const parts=i.split('T')[0].split('-');return `${parts[2]}.${parts[1]}.${parts[0]}`};const closeModal=()=>{document.getElementById('mdl').style.display='none';aId=null};const toggleF=id=>{const e=document.getElementById(id);e.style.display=e.style.display==='grid'||e.style.display==='block'?'none':(e.className.includes('arch-')?'grid':'block')};
const gP=(cat)=>{
    let init=[];
    if(cat==='WeightStock'||cat==='–ì–æ—Ç–æ–≤–∞—è') init=bP; 
    const s=new Set(init);
    const dbK=(cat==='WeightStock')?'WeightStock':(cat==='Stock_DV'?'Stock_DV':(cat==='Stock_Feed'?'Stock_Feed':(cat==='Stock_Semi'?'Stock_Semi':'–ì–æ—Ç–æ–≤–∞—è')));
    if(data[dbK])Object.values(data[dbK]).forEach(v=>s.add(v.name));
    return Array.from(s).filter(x=>x).sort();
};
const gRaw=()=>{const s=new Set();if(data.Krup_Report)Object.values(data.Krup_Report).forEach(v=>{if(v.raw)s.add(v.raw)});return Array.from(s).sort();}
const gS=()=>{const s=new Set();['ArchIncoming','–ü–∞–∫–µ—Ç—ã','–ü–ª–µ–Ω–∫–∞','–°–∫–æ—Ç—á 360 –≥—Ä–∞–º–º'].forEach(k=>{if(data[k])Object.values(data[k]).forEach(v=>{if(v.supplier)s.add(v.supplier)})});return Array.from(s).filter(x=>x).sort();};
const gCl=()=>{const s=new Set();if(data.ArchInvoices)Object.values(data.ArchInvoices).forEach(v=>s.add(v.client));return Array.from(s).filter(x=>x).sort();};
const gPack=(cat)=>{const s=new Set();if(cat==='–ü–∞–∫–µ—Ç—ã')szs.forEach(x=>s.add(x));if(cat==='–°–∫–æ—Ç—á')s.add('–°–∫–æ—Ç—á 360 –≥—Ä–∞–º–º');if(cat==='–ü–ª–µ–Ω–∫–∞')bP.forEach(x=>s.add(x));const dbK=cat==='–°–∫–æ—Ç—á'?'–°–∫–æ—Ç—á 360 –≥—Ä–∞–º–º':cat;if(data[dbK])Object.values(data[dbK]).forEach(v=>{if(v.name)s.add(v.name)});return Array.from(s).filter(x=>x).sort();};
function renderHome(){cur='Home';document.body.classList.remove('nav-active');document.getElementById('cnt').innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('StockRoot')">üì¶ –°–∫–ª–∞–¥</div><div class="dash-item" onclick="setCat('ProdSub')">‚öôÔ∏è –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</div><div class="dash-item" onclick="setCat('PackSub')">ü•° –£–ø–∞–∫–æ–≤–∫–∞</div><div class="dash-item" onclick="openModal('auth')" style="color:#aaa">üîê –í—Ö–æ–¥</div></div>`;document.getElementById('act').innerHTML='';updNav();}
function goBack(){const m={'StockList':'StockRoot','WeightStock':'StockRoot','Stock_DV':'StockRoot','Stock_Feed':'StockRoot','Stock_Semi':'StockRoot','Invoices':'StockRoot','ArchSubIn':'Invoices','ArchSubOut':'Invoices','InvoicesDate':'ArchSub','InvoicesClient':'ArchSub','–§–∞—Å–æ–≤–∫–∞':'ProdSub','Kruporushka':'ProdSub','ZSHM':'ProdSub','Vibro':'ProdSub','–ü–ª–µ–Ω–∫–∞':'PackSub','–ü–∞–∫–µ—Ç—ã':'PackSub','–°–∫–æ—Ç—á 360 –≥—Ä–∞–º–º':'PackSub'};let next=m[cur]||'Home';if(cur==='InvoicesDate'||cur==='InvoicesClient')next=archSub==='In'?'ArchSubIn':'ArchSubOut';setCat(next);}
function setCat(c){cur=c;document.body.classList.add('nav-active');const a=document.getElementById('act'),ct=document.getElementById('cnt');a.innerHTML='';if(c==='Home'){renderHome();return}if(c==='StockRoot'){a.innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:10px"><button class="btn-main" style="background:var(--s)" onclick="openModal('inc')">–ü—Ä–∏—Ö–æ–¥</button><button class="btn-main" style="background:var(--d)" onclick="openModal('ship')">–û—Ç–≥—Ä—É–∑–∫–∞</button></div>`;ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('StockList')">–§–∞—Å–æ–≤–∫–∞</div><div class="dash-item" onclick="setCat('WeightStock')">–ü–æ–∫—É–ø–Ω–∞—è</div><div class="dash-item" onclick="setCat('Stock_DV')">–°–∫–ª–∞–¥ –î–í</div><div class="dash-item" onclick="setCat('Stock_Feed')">–°–∫–ª–∞–¥ –ö–æ—Ä–º–∞</div><div class="dash-item" onclick="setCat('Stock_Semi')">–ü–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç</div><div class="dash-item" onclick="setCat('Invoices')">–ê—Ä—Ö–∏–≤</div></div><div id="corrCtls" style="margin-top:15px;display:flex;gap:5px"><button id="corrTgl" class="btn-main" style="background:#fff;border:1px solid #d1d5db;color:#333;margin:0" onclick="toggleCorr()">–ö–æ—Ä—Ä–µ–∫—Ü–∏—è: –í–´–ö–õ</button></div>`;}else if(c==='ProdSub')ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('–§–∞—Å–æ–≤–∫–∞')">–¶–µ—Ö —Ñ–∞—Å–æ–≤–∫–∏</div><div class="dash-item" onclick="setCat('Kruporushka')">–ö—Ä—É–ø–æ—Ä—É—à–∫–∞</div><div class="dash-item" onclick="setCat('ZSHM')">–ó–®–ú</div><div class="dash-item" onclick="setCat('Vibro')">–í–∏–±—Ä–æ—Å—Ç–æ–ª</div></div><button class="btn-main" style="background:var(--s);margin-top:10px" onclick="openModal('addRaw')">–ü–†–ò–•–û–î –°–´–†–¨–Ø</button>`;else if(c==='PackSub'){a.innerHTML=`<button class="btn-main" style="background:var(--s)" onclick="openModal('addMatPack')">–ü—Ä–∏—Ö–æ–¥ —É–ø–∞–∫–æ–≤–∫–∏</button><button id="corrTgl" class="btn-main" style="background:#fff;border:1px solid #d1d5db;color:#333;margin-top:5px" onclick="toggleCorr()">–ö–æ—Ä—Ä–µ–∫—Ü–∏—è: –í–´–ö–õ</button>`;ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('–ü–ª–µ–Ω–∫–∞')">–ü–ª–µ–Ω–∫–∞</div><div class="dash-item" onclick="setCat('–ü–∞–∫–µ—Ç—ã')">–ü–∞–∫–µ—Ç—ã</div><div class="dash-item" onclick="setCat('–°–∫–æ—Ç—á 360 –≥—Ä–∞–º–º')">–°–∫–æ—Ç—á</div></div>`;}else if(c==='–§–∞—Å–æ–≤–∫–∞')a.innerHTML=`<button class="btn-main" style="background:var(--p)" onclick="openModal('fas')">–ù–û–í–ê–Ø –ó–ê–ü–ò–°–¨</button>`;else if(c==='Kruporushka')a.innerHTML=`<button class="btn-main" style="background:var(--p)" onclick="openModal('addKrup')">–ù–û–í–ê–Ø –ó–ê–ü–ò–°–¨</button>`;else if(c==='Vibro')a.innerHTML=`<button class="btn-main" style="background:var(--p)" onclick="openModal('addVibro')">–ù–û–í–ê–Ø –ó–ê–ü–ò–°–¨</button>`;else if(c==='ZSHM')a.innerHTML=`<button class="btn-main" style="background:var(--p)" onclick="openModal('addZSHM')">–ù–û–í–ê–Ø –°–ú–ï–ù–ê</button>`;else if(c==='Invoices')ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('ArchSubIn')">–ü—Ä–∏—Ö–æ–¥—ã</div><div class="dash-item" onclick="setCat('ArchSubOut')">–û—Ç–≥—Ä—É–∑–∫–∏</div></div>`;else if(c==='ArchSubIn'||c==='ArchSubOut'){archSub=(c==='ArchSubIn'?'In':'Out');ct.innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('InvoicesDate')">–ü–æ –¥–∞—Ç–∞–º</div><div class="dash-item" onclick="setCat('InvoicesClient')">–ü–æ –∏–º–µ–Ω–∞–º</div></div>`;}loadData();updCorrBtn();updNav();}
function toggleCorr(){corrMode=!corrMode;updCorrBtn();loadData();}
function updCorrBtn(){const b=document.getElementById('corrTgl'),c=document.getElementById('corrCtls');if(b){b.innerText=corrMode?'–ö–û–†–†–ï–ö–¶–ò–Ø: –í–ö–õ':'–ö–û–†–†–ï–ö–¶–ò–Ø: –í–´–ö–õ';b.style.background=corrMode?'#f59e0b':'#fff';b.style.color=corrMode?'#fff':'#333';if(corrMode&&cur==='StockRoot'&&!document.getElementById('cleanBtn')){const btn=document.createElement('button');btn.id='cleanBtn';btn.className='btn-main';btn.innerText='–ß–ò–°–¢–ö–ê –°–ü–ò–°–ö–û–í';btn.style.background='#ef4444';btn.style.margin='0';btn.onclick=()=>openModal('clean');c.appendChild(btn);}if(!corrMode){const cb=document.getElementById('cleanBtn');if(cb)cb.remove();}}}
function updNav(){document.getElementById('navM').className=`${cur==='Home'?'nav-btn-active':''}`;document.getElementById('navB').className=`${cur!=='Home'?'nav-btn-active':''}`;}
function switchShipTab(id){document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.getElementById('tb_'+id).classList.add('active');document.querySelectorAll('.ship-sect').forEach(s=>s.classList.remove('active'));document.getElementById('sc_'+id).classList.add('active');}
function loadData(){db.on('value',s=>{data=s.val()||{};const c=document.getElementById('cnt');if(!c||['Home','StockRoot','Invoices','ArchSubIn','ArchSubOut','ProdSub','PackSub'].includes(cur))return;if(cur==='InvoicesDate')rInvD(c);else if(cur==='InvoicesClient')rInvC(c);else if(cur==='–§–∞—Å–æ–≤–∫–∞')rFas(c);else if(cur==='Kruporushka')rKrup(c);else if(cur==='Vibro')rVibro(c);else if(cur==='ZSHM')rZSHM(c);else if(cur==='StockList')rWH(c);else if(cur==='WeightStock')rWgh(c);else rGen(c);});}
function calcKrup(){let t=0;['kQ1','kQ2','kQ3','kMQ','kOQ'].forEach((q,i)=>{const kgId=q.replace('Q','W');const w=parseFloat(document.getElementById(kgId).value)||0,qty=parseFloat(document.getElementById(q).value)||0;t+=w*qty;});const sec=parseFloat(document.getElementById('kSecW').value)||0;document.getElementById('kMainW').value=(t-sec).toFixed(1);}
function calcVibro(){let t=0;for(let i=1;i<=3;i++){const q=parseFloat(document.getElementById(`vQ${i}`).value)||0,w=parseFloat(document.getElementById(`vW${i}`).value)||0;t+=q*w;}const sec=parseFloat(document.getElementById('vSecW').value)||0;document.getElementById('vRawW').value=(t-sec).toFixed(1);}
function calcZSHM(){const p=(parseFloat(document.getElementById('zQ_Prod').value)||0)*(parseFloat(document.getElementById('zW_Prod').value)||0),s=(parseFloat(document.getElementById('zQ_Sech').value)||0)*(parseFloat(document.getElementById('zW_Sech').value)||0),m=(parseFloat(document.getElementById('zQ_Much').value)||0)*(parseFloat(document.getElementById('zW_Much').value)||0),o=(parseFloat(document.getElementById('zQ_Otr').value)||0)*(parseFloat(document.getElementById('zW_Otr').value)||0);const sec=parseFloat(document.getElementById('zSecW').value)||0;document.getElementById('zRawW').value=(p+s+m+o-sec).toFixed(1);}
function toggleInput(id){const sel=document.getElementById('s_'+id),inp=document.getElementById('i_'+id);if(sel.value==='NEW'){sel.style.display='none';inp.style.display='block';inp.focus();}else{inp.style.display='none';}}
    </script>
    <script>
function rWH(c){const t={};gP('–ì–æ—Ç–æ–≤–∞—è').forEach(p=>t[p]=0);if(data.–ì–æ—Ç–æ–≤–∞—è)Object.values(data.–ì–æ—Ç–æ–≤–∞—è).forEach(v=>t[v.name]+=v.amount);let h=`<div class="item-grid ${corrMode?'show-corr':''}">`;Object.keys(t).sort().forEach(n=>{h+=`<div class="item-card ${t[n]<0?'alarm-blink':''}"><div class="item-title">${n}</div><div class="item-qty">${Math.round(t[n])}</div><button class="history-btn" onclick="showH('–ì–æ—Ç–æ–≤–∞—è','${n}')">üìú</button><button class="corr-btn" onclick="openModal('corr','–ì–æ—Ç–æ–≤–∞—è|${n}')">¬±</button></div>`;});c.innerHTML=h+'</div>';}
function rWgh(c){const t={};gP('WeightStock').forEach(p=>t[p]=0);if(data.WeightStock)Object.values(data.WeightStock).forEach(v=>t[v.name]+=v.amount);let h=`<div class="item-grid ${corrMode?'show-corr':''}">`;Object.keys(t).sort().forEach(n=>{h+=`<div class="item-card ${t[n]<0?'alarm-blink':''}"><div class="item-title">${n}</div><div class="item-qty">${Math.round(t[n])}</div><button class="history-btn" onclick="showH('WeightStock','${n}')">üìú</button><button class="corr-btn" onclick="openModal('corr','WeightStock|${n}')">¬±</button></div>`;});c.innerHTML=h+'</div>';}
function rGen(c){const d=data[cur]||{},t={},u='–∫–≥';Object.values(d).forEach(v=>{let k=v.name;if(k)t[k]=(t[k]||0)+v.amount});let h=`<div class="item-grid ${corrMode?'show-corr':''}">`;Object.keys(t).sort().forEach(k=>{const val=t[k];let alarm=val<0;if(cur==='–ü–ª–µ–Ω–∫–∞'&&val<50)alarm=true;if(cur==='–°–∫–æ—Ç—á 360 –≥—Ä–∞–º–º'&&val<30)alarm=true;if(cur==='–ü–∞–∫–µ—Ç—ã'&&val<3000)alarm=true;h+=`<div class="item-card ${alarm?'alarm-blink':''}"><div class="item-title">${k}</div><div class="item-qty">${cur==='–°–∫–æ—Ç—á 360 –≥—Ä–∞–º–º'?val.toFixed(1):Math.round(val)} <small style="font-size:10px">${u}</small></div><button class="history-btn" onclick="showH('${cur}','${k}')">üìú</button><button class="corr-btn" onclick="openModal('corr','${cur}|${k}')">¬±</button></div>`;});c.innerHTML=h+'</div>';}
function rFas(c){let h='';if(data.–§–∞—Å–æ–≤–∫–∞){Object.entries(data.–§–∞—Å–æ–≤–∫–∞).sort((a,b)=>(b[1].date+b[1].ts).localeCompare(a[1].date+a[1].ts)).forEach(([id,v])=>{const pl=Math.abs((v.vzial||0)-(v.ostatok||0)).toFixed(1), k=(v.name==="–ö—É—Ç—è")?19.8:9.9, pk=Math.round(Math.abs(v.vyhod/k));h+=`<div class="card"><b>${v.name.toUpperCase()}</b> [${fd(v.date)}]<div class="report-line"><span>–°—ã—Ä—å–µ:</span><b>${v.prihod}–∫–≥ [${v.rawItem}]</b></div><div class="report-line"><span>–í—ã—Ö–æ–¥:</span><b>${v.vyhod}—à—Ç</b></div><div class="report-line"><span>–ü–∞–∫–µ—Ç—ã:</span><b>${v.size} [${pk}—à—Ç]</b></div><div class="report-line"><span>–ü–ª–µ–Ω–∫–∞:</span><b>${pl}–∫–≥</b></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:5px;margin-top:8px"><button class="btn-main" style="padding:6px;font-size:10px" onclick="openModal('fas','${id}')">–ü–†–ê–í–ò–¢–¨</button>${corrMode?`<button class="btn-main" style="background:var(--d);padding:6px;font-size:10px" onclick="delFas('${id}')">–£–î–ê–õ–ò–¢–¨</button>`:''}</div></div>`;});}c.innerHTML=h||'–ó–∞–ø–∏—Å–µ–π –Ω–µ—Ç';}
function rKrup(c){let h='';if(data.Krup_Report){Object.entries(data.Krup_Report).sort((a,b)=>(b[1].date+b[1].ts).localeCompare(a[1].date+a[1].ts)).forEach(([id,v])=>{h+=`<div class="card"><b>–û–¢–ß–ï–¢ –ö–†–£–ü–û–†–£–®–ö–ê</b> [${fd(v.date)}]<div style="font-size:11px;color:#888">${v.rawMix}</div><hr style="opacity:0.3">`;v.items.forEach(i=>{h+=`<div class="report-line"><span>${i.n}</span><b>${i.q}–º [${i.w}–∫–≥]</b></div>`});if(corrMode)h+=`<button class="btn-main" style="background:var(--d);padding:6px;font-size:10px;margin-top:8px" onclick="delKrup('${id}')">–£–î–ê–õ–ò–¢–¨</button>`;h+='</div>';});}c.innerHTML=h||'–ó–∞–ø–∏—Å–µ–π –Ω–µ—Ç';}
function rVibro(c){let h='';if(data.Vibro_Report){Object.entries(data.Vibro_Report).sort((a,b)=>(b[1].date+b[1].ts).localeCompare(a[1].date+a[1].ts)).forEach(([id,v])=>{h+=`<div class="card"><b>–í–ò–ë–†–û–°–¢–û–õ</b> [${fd(v.date)}]<div style="font-size:11px;color:#888">${v.rawMix}</div><hr style="opacity:0.3">`;v.items.forEach(i=>{h+=`<div class="report-line"><span>${i.n}</span><b>${i.q}–º [${i.w}–∫–≥]</b></div>`});if(corrMode)h+=`<button class="btn-main" style="background:var(--d);padding:6px;font-size:10px;margin-top:8px" onclick="delVibro('${id}')">–£–î–ê–õ–ò–¢–¨</button>`;h+='</div>';});}c.innerHTML=h||'–ó–∞–ø–∏—Å–µ–π –Ω–µ—Ç';}
function rZSHM(c){let h='';if(data.ZSHM_Report){Object.entries(data.ZSHM_Report).sort((a,b)=>(b[1].date+b[1].ts).localeCompare(a[1].date+a[1].ts)).forEach(([id,v])=>{h+=`<div class="card"><b>–ó–®–ú –°–ú–ï–ù–ê</b> [${fd(v.date)}]<div style="font-size:11px;color:#888">${v.rawMix}</div><hr style="opacity:0.3">`;v.items.forEach(i=>{h+=`<div class="report-line"><span>${i.n}</span><b>${i.w}–∫–≥</b></div>`});if(corrMode)h+=`<button class="btn-main" style="background:var(--d);padding:6px;font-size:10px;margin-top:8px" onclick="delZSHM('${id}')">–£–î–ê–õ–ò–¢–¨</button>`;h+='</div>';});}c.innerHTML=h||'–ó–∞–ø–∏—Å–µ–π –Ω–µ—Ç';}
function rCleanList(c){let h='<div style="font-size:11px;color:#666;margin-bottom:10px">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–º—è –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è:</div>';
h+='<div class="clean-cat">üì¶ –¢–û–í–ê–†–´</div>';const prods=new Set([...gP('WeightStock'),...gP('Stock_DV'),...gP('Stock_Feed'),...gP('Stock_Semi'),...gP('–ì–æ—Ç–æ–≤–∞—è')]);Array.from(prods).sort().forEach(n=>{h+=`<div onclick="delItemBatch('${n}','name')" style="padding:10px;border-bottom:1px solid #eee;cursor:pointer;display:flex;justify-content:space-between"><b>${n}</b><span style="color:red">üóëÔ∏è</span></div>`});
h+='<div class="clean-cat">üöõ –ü–û–°–¢–ê–í–©–ò–ö–ò</div>';gS().forEach(n=>{h+=`<div onclick="delItemBatch('${n}','supplier')" style="padding:10px;border-bottom:1px solid #eee;cursor:pointer;display:flex;justify-content:space-between"><b>${n}</b><span style="color:red">üóëÔ∏è</span></div>`});
h+='<div class="clean-cat">ü§ù –ö–õ–ò–ï–ù–¢–´</div>';gCl().forEach(n=>{h+=`<div onclick="delItemBatch('${n}','client')" style="padding:10px;border-bottom:1px solid #eee;cursor:pointer;display:flex;justify-content:space-between"><b>${n}</b><span style="color:red">üóëÔ∏è</span></div>`});c.innerHTML=h;}
function showH(c,k){const ti=document.getElementById('mT'),b=document.getElementById('mB');ti.innerText=k;const hist=[];if(data[c])Object.entries(data[c]).filter(([id,v])=>v.name===k).forEach(([id,v])=>{let n=v.note||'–ó–∞–ø–∏—Å—å';if(v.supplier)n='–ü—Ä–∏—Ö–æ–¥: '+v.supplier;if(v.client)n='–û—Ç–≥—Ä—É–∑–∫–∞: '+v.client;hist.push({d:v.date,ts:v.ts||'',n:n,a:v.amount,id:id})});let h='<table style="width:100%;font-size:11px;border-collapse:collapse">';hist.sort((a,b)=>{const keyA=a.d+a.ts, keyB=b.d+b.ts; return keyB.localeCompare(keyA);}).forEach(v=>{h+=`<tr style="border-bottom:1px solid #ccc"><td style="padding:6px 0">${fd(v.d)}<br>${v.n}</td><td style="text-align:right" class="${v.a>=0?'hist-pos':'hist-neg'}">${c==='–ü–∞–∫–µ—Ç—ã'?Math.round(v.a):v.a.toFixed(1)}</td><td style="width:30px;text-align:center">${corrMode?`<button onclick="delRec('${c}','${v.id}')" style="color:red;border:none;background:none;font-weight:900;font-size:16px;padding:0 10px;cursor:pointer">‚úï</button>`:''}</td></tr>`});b.innerHTML=h+'</table>';document.getElementById('mdl').style.display='flex'}
function rInvD(c){const dbK=(archSub==='In'?'ArchIncoming':'ArchInvoices'),d=data[dbK]||{},t={};Object.entries(d).forEach(([id,v])=>{const dt=new Date(v.date),y=dt.getFullYear(),m=dt.getMonth(),dy=dt.getDate();if(!t[y])t[y]={c:0,m:{}};if(!t[y].m[m])t[y].m[m]={c:0,d:{}};if(!t[y].m[m].d[dy])t[y].m[m].d[dy]=[];t[y].m[m].d[dy].push({...v,id});t[y].c++;t[y].m[m].c++;});let h='';Object.keys(t).sort((a,b)=>b-a).forEach(y=>{h+=`<div class="arch-tile-y" onclick="toggleF('y${y}')">${y}</div><div id="y${y}" class="arch-content"><div class="arch-m-grid">`;Object.keys(t[y].m).sort((a,b)=>b-a).forEach(m=>{h+=`<div class="arch-tile-m" onclick="toggleF('m${y}${m}')">${mths[m]}<div class="arch-badge">${t[y].m[m].c}</div></div><div id="m${y}${m}" class="arch-content" style="grid-column:1/-1"><div class="arch-d-grid">`;Object.keys(t[y].m[m].d).sort((a,b)=>b-a).forEach(dy=>{h+=`<div class="arch-tile-d" onclick="toggleF('d${y}${m}${dy}')">${dy}<div class="arch-badge">${t[y].m[m].d[dy].length}</div></div><div id="d${y}${m}${dy}" class="arch-content" style="grid-column:1/-1">`;t[y].m[m].d[dy].sort((a,b)=>(b.date+b.ts).localeCompare(a.date+a.ts)).forEach(v=>h+=`<div class="arch-inv" onclick="openModal('vInv','${v.id}|${dbK}')"><div><b>${(v.num||'–ë/–ù')}</b>${v.client||v.supplier}</div><div>üìÑ</div>${corrMode?`<button onclick="event.stopPropagation();delRec('${dbK}','${v.id}')" style="color:red;border:none;background:none;font-weight:900;font-size:16px;padding:5px">‚úï</button>`:''}</div>`);h+=`</div>`;});h+=`</div></div>`;});h+=`</div></div>`;});c.innerHTML=h||'–ü—É—Å—Ç–æ';}
function rInvC(c){const dbK=(archSub==='In'?'ArchIncoming':'ArchInvoices'),d=data[dbK]||{},cl={};Object.entries(d).forEach(([id,v])=>{const n=v.client||v.supplier;if(!cl[n])cl[n]=[];cl[n].push({...v,id});});let h='';Object.keys(cl).sort().forEach((n,i)=>{h+=`<div class="arch-cl-tile" onclick="toggleF('cl${i}')"><span>${n}</span><span>[${cl[n].length}]</span></div><div id="cl${i}" class="arch-content">`;cl[n].sort((a,b)=>(b.date+b.ts).localeCompare(a.date+a.ts)).forEach(v=>h+=`<div class="arch-inv" onclick="openModal('vInv','${v.id}|${dbK}')"><div><b>${(v.num||'–ë/–ù')}</b>${fd(v.date)}</div><div>üìÑ</div>${corrMode?`<button onclick="event.stopPropagation();delRec('${dbK}','${v.id}')" style="color:red;border:none;background:none;font-weight:900;font-size:16px;padding:5px">‚úï</button>`:''}</div>`);h+=`</div>`;});c.innerHTML=h||'–ü—É—Å—Ç–æ';}
    </script>
    <script>
async function delRec(cat, id) {if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å –Ω–∞–≤—Å–µ–≥–¥–∞?')){await db.child(cat).child(id).remove();closeModal();}}
async function delItemBatch(val, type) {if(!confirm(`–í–ù–ò–ú–ê–ù–ò–ï! –£–¥–∞–ª–∏—Ç—å "${val}" –∏–∑–æ –≤—Å–µ—Ö —Å–ø–∏—Å–∫–æ–≤ –∏ –∞—Ä—Ö–∏–≤–æ–≤?`)) return;const updates = {};Object.keys(data).forEach(cat => {Object.entries(data[cat]).forEach(([id, v]) => {if (type === 'name' && v.name === val) updates[`/${cat}/${id}`] = null;if (type === 'supplier' && v.supplier === val) updates[`/${cat}/${id}`] = null;if (type === 'client' && v.client === val) updates[`/${cat}/${id}`] = null;});});await db.update(updates);closeModal();alert('–£–¥–∞–ª–µ–Ω–æ');}
async function sFas(){const btn=document.getElementById('btnS');if(btn)btn.disabled=true;const d=document.getElementById('fD').value,n=document.getElementById('fN').value,raw=document.getElementById('fRaw').value,s=document.getElementById('fS').value,v=parseFloat(document.getElementById('fV').value),p=parseFloat(document.getElementById('fP').value),os=parseFloat(document.getElementById('fOs').value);let vzStr=document.getElementById('fVz').value.replace(/,/g,'.');let vzTotal=0;try{vzTotal=eval(vzStr.replace(/[^-+0-9.]/g,''))||0}catch(e){vzTotal=0}const k=(n==="–ö—É—Ç—è")?19.8:9.9,sp=-Math.round(v/k),plUsed=Math.abs(vzTotal-os),scUsed=parseFloat(((v*0.12)/360).toFixed(1)),fId=db.child('–§–∞—Å–æ–≤–∫–∞').push().key,ts=new Date().toISOString(),dV=d+"T12:00:00Z";
let srcCat='WeightStock';if(data.Stock_DV){const vals=Object.values(data.Stock_DV);if(vals.find(x=>x.name===raw))srcCat='Stock_DV';}
const updates={};updates['/–§–∞—Å–æ–≤–∫–∞/'+fId]={date:dV,name:n,rawItem:raw,size:s,vyhod:v,prihod:p,vzial:vzTotal,ostatok:os,link:fId,ts:ts};updates['/–ì–æ—Ç–æ–≤–∞—è/'+db.child('–ì–æ—Ç–æ–≤–∞—è').push().key]={name:n,amount:v,date:dV,note:'–§–∞—Å–æ–≤–∫–∞',fLink:fId,ts:ts};updates[`/${srcCat}/`+db.child(srcCat).push().key]={name:raw,amount:-p,date:dV,note:'–§–∞—Å–æ–≤–∫–∞: '+n,fLink:fId,ts:ts};updates['/–ü–∞–∫–µ—Ç—ã/'+db.child('–ü–∞–∫–µ—Ç—ã').push().key]={name:s,amount:sp,date:dV,note:'(–∞–≤—Ç–æ) –§–∞—Å–æ–≤–∫–∞: '+n,fLink:fId,ts:ts};updates['/–ü–ª–µ–Ω–∫–∞/'+db.child('–ü–ª–µ–Ω–∫–∞').push().key]={name:n,amount:-plUsed,date:dV,note:'(–∞–≤—Ç–æ) –§–∞—Å–æ–≤–∫–∞: '+n,fLink:fId,ts:ts};updates['/–°–∫–æ—Ç—á 360 –≥—Ä–∞–º–º/'+db.child('–°–∫–æ—Ç—á 360 –≥—Ä–∞–º–º').push().key]={name:'–°–∫–æ—Ç—á 360 –≥—Ä–∞–º–º',amount:-scUsed,date:dV,note:'(–∞–≤—Ç–æ) –§–∞—Å–æ–≤–∫–∞: '+n,fLink:fId,ts:ts};await db.update(updates);closeModal();alert('–ó–∞–ø–∏—Å–∞–Ω–æ');}
async function sKrup(){
    const btn=document.getElementById('btnS');if(btn)btn.disabled=true;
    const d=document.getElementById('kD').value,ts=new Date().toISOString(),dV=d+"T12:00:00Z",updates={},items=[],kId=db.child('Krup_Report').push().key;
    const mainRawName=document.getElementById('kMainName').value;
    const secRawName=document.getElementById('kSecName').value;
    const secRawW=parseFloat(document.getElementById('kSecW').value)||0;
    const mainRawW=parseFloat(document.getElementById('kMainW').value)||0;

    if(!mainRawName || mainRawW<=0){btn.disabled=false; alert('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—ã—Ä—å—è'); return;}

    updates[`/Stock_Semi/${db.child('Stock_Semi').push().key}`]={name:mainRawName,amount:-mainRawW,date:dV,ts:ts,note:'–ö—Ä—É–ø–æ—Ä—É—à–∫–∞ –û—Å–Ω–æ–≤–∞',fLink:kId};
    let rawMixStr = `${mainRawName}(${mainRawW}–∫–≥)`;
    if(secRawName && secRawW){
        updates[`/Stock_Semi/${db.child('Stock_Semi').push().key}`]={name:secRawName,amount:-secRawW,date:dV,ts:ts,note:'–ö—Ä—É–ø–æ—Ä—É—à–∫–∞ –î–æ–±–∞–≤–∫–∞',fLink:kId};
        rawMixStr += ` + ${secRawName}(${secRawW}–∫–≥)`;
    }

    for(let i=1;i<=3;i++){
        let n=document.getElementById(`s_kN${i}`).value;
        if(n==='NEW') n=document.getElementById(`i_kN${i}`).value;
        const q=parseFloat(document.getElementById(`kQ${i}`).value),w=parseFloat(document.getElementById(`kW${i}`).value);
        if(n&&q&&w){
            const tot=q*w;items.push({n:n,q:q,w:w});
            updates[`/Stock_DV/${db.child('Stock_DV').push().key}`]={name:`${n} [${w}–∫–≥]`,amount:tot,date:dV,ts:ts,note:'–ö—Ä—É–ø–æ—Ä—É—à–∫–∞',fLink:kId};
        }
    }
    ['M','O'].forEach(t=>{
        let n=document.getElementById(`s_k${t}N`).value;
        if(n==='NEW') n=document.getElementById(`i_k${t}N`).value;
        const q=parseFloat(document.getElementById(`k${t}Q`).value),w=parseFloat(document.getElementById(`k${t}W`).value);
        if(n&&q&&w){
            const tot=q*w;items.push({n:n,q:q,w:w});
            updates[`/Stock_Feed/${db.child('Stock_Feed').push().key}`]={name:n,amount:tot,date:dV,ts:ts,note:'–ö—Ä—É–ø–æ—Ä—É—à–∫–∞',fLink:kId};
        }
    });

    if(items.length){
        updates[`/Krup_Report/${kId}`]={date:dV,ts:ts,items:items,rawMix:rawMixStr,link:kId};
        await db.update(updates);closeModal();alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
    }else{
        btn.disabled=false;alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—ã—Ö–æ–¥');
    }
}
async function sVibro(){
    const btn=document.getElementById('btnS');if(btn)btn.disabled=true;
    const d=document.getElementById('vD').value,ts=new Date().toISOString(),dV=d+"T12:00:00Z",updates={},items=[],vId=db.child('Vibro_Report').push().key;
    const mainRawName=document.getElementById('vMain').value;
    const secRawName=document.getElementById('vSecName').value;
    const secRawW=parseFloat(document.getElementById('vSecW').value)||0;
    const mainRawW=parseFloat(document.getElementById('vRawW').value)||0;

    if(!mainRawName || mainRawW<=0){btn.disabled=false; alert('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—ã—Ä—å—è'); return;}

    updates[`/Stock_Semi/${db.child('Stock_Semi').push().key}`]={name:mainRawName,amount:-mainRawW,date:dV,ts:ts,note:'–í–∏–±—Ä–æ –û—Å–Ω–æ–≤–∞',fLink:vId};
    let rawMixStr = `${mainRawName}(${mainRawW}–∫–≥)`;
    if(secRawName && secRawW){
        updates[`/Stock_Semi/${db.child('Stock_Semi').push().key}`]={name:secRawName,amount:-secRawW,date:dV,ts:ts,note:'–í–∏–±—Ä–æ –î–æ–±–∞–≤–∫–∞',fLink:vId};
        rawMixStr += ` + ${secRawName}(${secRawW}–∫–≥)`;
    }

    for(let i=1;i<=3;i++){
        let n=document.getElementById(`s_vN${i}`).value;
        if(n==='NEW') n=document.getElementById(`i_vN${i}`).value;
        const q=parseFloat(document.getElementById(`vQ${i}`).value),w=parseFloat(document.getElementById(`vW${i}`).value);
        if(n&&q&&w){
            const tot=q*w;items.push({n:n,q:q,w:w});
            const dest=(i===1?'Stock_Semi':'Stock_Feed');
            updates[`/${dest}/${db.child(dest).push().key}`]={name:n,amount:tot,date:dV,ts:ts,note:'–í–∏–±—Ä–æ—Å—Ç–æ–ª',fLink:vId};
        }
    }
    if(items.length){
        updates[`/Vibro_Report/${vId}`]={date:dV,ts:ts,items:items,rawMix:rawMixStr,link:vId};
        await db.update(updates);closeModal();alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
    }else{btn.disabled=false;alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ');}
}
async function sZSHM(){
    const btn=document.getElementById('btnS');if(btn)btn.disabled=true;
    const d=document.getElementById('zD').value,ts=new Date().toISOString(),dV=d+"T12:00:00Z",updates={},items=[],zId=db.child('ZSHM_Report').push().key;
    const mainRawName=document.getElementById('zMain').value;
    const secRawName=document.getElementById('zSecName').value;
    const secRawW=parseFloat(document.getElementById('zSecW').value)||0;
    const mainRawW=parseFloat(document.getElementById('zRawW').value)||0;

    if(!mainRawName || mainRawW<=0){btn.disabled=false; alert('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—ã—Ä—å—è'); return;}

    updates[`/Stock_Semi/${db.child('Stock_Semi').push().key}`]={name:mainRawName,amount:-mainRawW,date:dV,ts:ts,note:'–ó–®–ú –û—Å–Ω–æ–≤–∞',fLink:zId};
    let rawMixStr = `${mainRawName}(${mainRawW}–∫–≥)`;
    if(secRawName && secRawW){
        updates[`/Stock_Semi/${db.child('Stock_Semi').push().key}`]={name:secRawName,amount:-secRawW,date:dV,ts:ts,note:'–ó–®–ú –î–æ–±–∞–≤–∫–∞',fLink:zId};
        rawMixStr += ` + ${secRawName}(${secRawW}–∫–≥)`;
    }

    let pN=document.getElementById('s_zN_Prod').value; if(pN==='NEW') pN=document.getElementById('i_zN_Prod').value;
    const pQ=parseFloat(document.getElementById('zQ_Prod').value)||0,pW=parseFloat(document.getElementById('zW_Prod').value)||0;if(pN&&pQ&&pW){const tot=pQ*pW;items.push({n:pN,q:pQ,w:pW});updates[`/Stock_DV/${db.child('Stock_DV').push().key}`]={name:`${pN} [${pW}–∫–≥]`,amount:tot,date:dV,ts:ts,note:'–ó–®–ú',fLink:zId};}
    let sN=document.getElementById('s_zN_Sech').value; if(sN==='NEW') sN=document.getElementById('i_zN_Sech').value;
    const sQ=parseFloat(document.getElementById('zQ_Sech').value)||0,sW=parseFloat(document.getElementById('zW_Sech').value)||0;if(sN&&sQ&&sW){const tot=sQ*sW;items.push({n:sN,q:sQ,w:sW});updates[`/Stock_Semi/${db.child('Stock_Semi').push().key}`]={name:sN,amount:tot,date:dV,ts:ts,note:'–ó–®–ú –°–µ—á–∫–∞',fLink:zId};}
    let mN=document.getElementById('s_zN_Much').value; if(mN==='NEW') mN=document.getElementById('i_zN_Much').value;
    const mQ=parseFloat(document.getElementById('zQ_Much').value)||0,mW=parseFloat(document.getElementById('zW_Much').value)||0;if(mN&&mQ&&mW){const tot=mQ*mW;items.push({n:mN,q:mQ,w:mW});updates[`/Stock_Feed/${db.child('Stock_Feed').push().key}`]={name:mN,amount:tot,date:dV,ts:ts,note:'–ó–®–ú –ú—É—á–∫–∞',fLink:zId};}
    let oN=document.getElementById('s_zN_Otr').value; if(oN==='NEW') oN=document.getElementById('i_zN_Otr').value;
    const oQ=parseFloat(document.getElementById('zQ_Otr').value)||0,oW=parseFloat(document.getElementById('zW_Otr').value)||0;if(oN&&oQ&&oW){const tot=oQ*oW;items.push({n:oN,q:oQ,w:oW});updates[`/Stock_Feed/${db.child('Stock_Feed').push().key}`]={name:oN,amount:tot,date:dV,ts:ts,note:'–ó–®–ú –û—Ç—Ä—É–±–∏',fLink:zId};}
    
    if(items.length){
        updates[`/ZSHM_Report/${zId}`]={date:dV,ts:ts,items:items,rawMix:rawMixStr,link:zId};
        await db.update(updates);closeModal();alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
    }else{btn.disabled=false;alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ');}
}
async function sRawInc(){const btn=document.getElementById('btnS');if(btn)btn.disabled=true;
    let n=document.getElementById('s_rN').value; if(n==='NEW') n=document.getElementById('i_rN').value;
    let s=document.getElementById('s_rSupp').value; if(s==='NEW') s=document.getElementById('i_rSupp').value;
    const a=parseFloat(document.getElementById('rA').value),d=new Date().toISOString().split('T')[0]+"T12:00:00Z",ts=new Date().toISOString();
    if(n&&a){const updates={};updates['/Stock_Semi/'+db.child('Stock_Semi').push().key]={name:n,amount:a,date:d,ts:ts,note:'–ü—Ä–∏—Ö–æ–¥ —Å—ã—Ä—å—è',supplier:s};updates['/ArchIncoming/'+db.child('ArchIncoming').push().key]={name:n,amount:a,date:d,ts:ts,note:'–°—ã—Ä—å–µ',supplier:s};await db.update(updates);closeModal();alert('–ü—Ä–∏–Ω—è—Ç–æ');}
}
async function sInc(){const btn=document.getElementById('btnS');if(btn)btn.disabled=true;const dst=document.getElementById('iDst').value,d=document.getElementById('iD').value;
    let n=document.getElementById('s_iN').value; if(n==='NEW') n=document.getElementById('i_iN').value;
    let s=document.getElementById('s_iSupp').value; if(s==='NEW') s=document.getElementById('i_iSupp').value;
    const a=parseFloat(document.getElementById('iA').value),num=document.getElementById('iNum').value;
    if(a&&n){const iId=db.child('ArchIncoming').push().key,ts=new Date().toISOString(),dV=d+"T12:00:00Z";const updates={};updates['/ArchIncoming/'+iId]={date:dV,ts:ts,name:n,amount:a,supplier:s,num:num};updates['/'+dst+'/'+db.child(dst).push().key]={date:dV,ts:ts,name:n,amount:a,supplier:s,note:num};await db.update(updates);closeModal();}
}
async function sShip(){const btn=document.getElementById('btnS');if(btn)btn.disabled=true;const d=document.getElementById('sD').value;
    let cl=document.getElementById('s_sC').value; if(cl==='NEW') cl=document.getElementById('i_sC').value;
    const items=[],updates={},ts=new Date().toISOString(),dV=d+"T12:00:00Z";document.querySelectorAll('.s-in').forEach(i=>{const a=parseFloat(i.value);if(a>0){const p=i.dataset.p,c=i.dataset.cat;items.push(p+': '+a);updates['/'+c+'/'+db.child(c).push().key]={name:p,amount:-a,date:dV,ts:ts,client:cl};}});if(items.length){updates['/ArchInvoices/'+db.child('ArchInvoices').push().key]={date:dV,ts:ts,client:cl,items:items};await db.update(updates);}closeModal();
}
                         </script>
                         <script>
function makeSelect(id, cat, ph, sourceOverride) {
    let opts = `<option value="">${ph}...</option>`;
    let list = [];
    if(sourceOverride) list = sourceOverride;
    else {
        if(cat === 'Stock_DV') {
            const rawSet = new Set();
            gP(cat).forEach(full => rawSet.add(full.split(' [')[0]));
            list = Array.from(rawSet).sort();
        } else {
            list = gP(cat);
        }
    }
    list.forEach(n => opts += `<option value="${n}">${n}</option>`);
    opts += `<option value="NEW" style="font-weight:bold;color:var(--p)">+ –ù–û–í–´–ô</option>`;
    return `<select id="s_${id}" onchange="toggleInput('${id}')" style="width:100%">${opts}</select><input type="text" id="i_${id}" class="new-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" style="display:none;width:100%">`;
}

function openModal(t,id){const ti=document.getElementById('mT'),b=document.getElementById('mB');if(!id)aId=null;else aId=id;if(t=='auth'){ti.innerText='–í—Ö–æ–¥ / –°–±—Ä–æ—Å';b.innerHTML=`<input type="email" id="lE" value="nukonor@gmail.com"><input type="password" id="lP"><button class="btn-main" onclick="login()">–í–•–û–î</button><hr><button class="btn-main" style="background:var(--d)" onclick="if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –±–∞–∑—É?')){db.set(null);location.reload()}">–û–ë–ù–£–õ–ò–¢–¨ –ë–ê–ó–£</button>`;}else if(t=='clean'){rCleanList(b);ti.innerText='–ß–ò–°–¢–ö–ê (–£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞)';}else if(t=='addMatPack'){ti.innerText='–ü—Ä–∏—Ö–æ–¥ –£–ø–∞–∫–æ–≤–∫–∏';b.innerHTML=`–†–∞–∑–¥–µ–ª:<select id="mCat" onchange="const s=document.getElementById('mS');const list=gPack(this.value);s.innerHTML='<option value=>–í—ã–±—Ä–∞—Ç—å...</option>'+list.map(x=>'<option value=\\''+x+'\\'>'+x+'</option>').join('')+'<option value=NEW>+ –ù–û–í–´–ô</option>'"><option value="">–í—ã–±—Ä–∞—Ç—å...</option><option value="–ü–∞–∫–µ—Ç—ã">–ü–∞–∫–µ—Ç—ã</option><option value="–ü–ª–µ–Ω–∫–∞">–ü–ª–µ–Ω–∫–∞</option><option value="–°–∫–æ—Ç—á">–°–∫–æ—Ç—á</option></select>–¢–∏–ø:<select id="mS" onchange="document.getElementById('mSn').style.display=this.value==='NEW'?'block':'none'"><option value="">–í—ã–±—Ä–∞—Ç—å...</option></select><input type="text" id="mSn" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" style="display:none">–ü–æ—Å—Ç–∞–≤—â–∏–∫:<select id="mSuppS" onchange="document.getElementById('mSuppN').style.display=this.value==='NEW'?'block':'none'"><option value=>–í—ã–±—Ä–∞—Ç—å...</option>${gS().map(s=>`<option value="${s}">${s}</option>`).join('')}<option value="NEW">+ –ù–û–í–´–ô</option></select><input type="text" id="mSuppN" placeholder="–ò–º—è –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞" style="display:none">–ö–æ–ª-–≤–æ:<input type="number" id="mA">–î–∞—Ç–∞:<input type="date" id="mDate" value="${new Date().toISOString().split('T')[0]}"><button class="btn-main" id="btnS" onclick="if(confirm('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –∑–∞–ø–∏—Å—å?'))sMatP()">–ó–ê–ü–ò–°–ê–¢–¨</button>`;}
else if(t=='inc'){ti.innerText='–ü—Ä–∏—Ö–æ–¥';b.innerHTML=`–°–∫–ª–∞–¥:<select id="iDst" onchange="const s=document.getElementById('s_iN');const list=gP(this.value);let o='<option value=>–í—ã–±—Ä–∞—Ç—å...</option>';list.forEach(x=>o+='<option value=\\''+x+'\\'>'+x+'</option>');o+='<option value=NEW>+ –ù–û–í–´–ô</option>';s.innerHTML=o"><option value="WeightStock">–ü–û–ö–£–ü–ù–ê–Ø</option><option value="–ì–æ—Ç–æ–≤–∞—è">–§–ê–°–û–í–ö–ê</option><option value="Stock_DV">–°–ö–õ–ê–î –î–í</option><option value="Stock_Feed">–ö–û–†–ú–ê</option></select>–î–∞—Ç–∞:<input type="date" id="iD" value="${new Date().toISOString().split('T')[0]}">–ü—Ä–æ–¥—É–∫—Ç:${makeSelect('iN','WeightStock','–ü—Ä–æ–¥—É–∫—Ç')}–ü–æ—Å—Ç–∞–≤—â–∏–∫:${makeSelect('iSupp','','–ü–æ—Å—Ç–∞–≤—â–∏–∫',gS())}–ö–æ–ª-–≤–æ:<input type="number" id="iA">‚Ññ –ù–∞–∫–ª:<input type="text" id="iNum"><button class="btn-main" id="btnS" onclick="if(confirm('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –∑–∞–ø–∏—Å—å?'))sInc()">–ó–ê–ü–ò–°–ê–¢–¨</button>`;}
else if(t=='ship'){ti.innerText='–û—Ç–≥—Ä—É–∑–∫–∞';b.innerHTML=`–î–∞—Ç–∞:<input type="date" id="sD" value="${new Date().toISOString().split('T')[0]}">–ö–ª–∏–µ–Ω—Ç:${makeSelect('sC','','–ö–ª–∏–µ–Ω—Ç',gCl())}
<div class="tab-group"><button id="tb_Got" class="tab-btn active" onclick="switchShipTab('Got')">–§–ê–°–û–í–ö–ê</button><button id="tb_Wgh" class="tab-btn" onclick="switchShipTab('Wgh')">–ü–û–ö–£–ü–ù–ê–Ø</button><button id="tb_DV" class="tab-btn" onclick="switchShipTab('DV')">–î–í</button><button id="tb_Fd" class="tab-btn" onclick="switchShipTab('Fd')">–ö–û–†–ú–ê</button></div>
<div id="shipGridF" class="item-body" style="max-height:400px;overflow-y:auto;margin-top:5px">
<div id="sc_Got" class="ship-sect active item-grid">${gP('–ì–æ—Ç–æ–≤–∞—è').map(p=>`<div class="item-card"><div class="item-title">${p}</div><input type="number" class="s-in" data-cat="–ì–æ—Ç–æ–≤–∞—è" data-p="${p}" style="width:100%;box-sizing:border-box;border:1px solid #eee;border-radius:4px;padding:4px;text-align:center" placeholder="—à—Ç"></div>`).join('')}</div>
<div id="sc_Wgh" class="ship-sect item-grid">${gP('WeightStock').map(p=>`<div class="item-card"><div class="item-title">${p}</div><input type="number" class="s-in" data-cat="WeightStock" data-p="${p}" style="width:100%;box-sizing:border-box;border:1px solid #eee;border-radius:4px;padding:4px;text-align:center" placeholder="–∫–≥"></div>`).join('')}</div>
<div id="sc_DV" class="ship-sect item-grid">${gP('Stock_DV').map(p=>`<div class="item-card"><div class="item-title">${p}</div><input type="number" class="s-in" data-cat="Stock_DV" data-p="${p}" style="width:100%;box-sizing:border-box;border:1px solid #eee;border-radius:4px;padding:4px;text-align:center" placeholder="–∫–≥"></div>`).join('')}</div>
<div id="sc_Fd" class="ship-sect item-grid">${gP('Stock_Feed').map(p=>`<div class="item-card"><div class="item-title">${p}</div><input type="number" class="s-in" data-cat="Stock_Feed" data-p="${p}" style="width:100%;box-sizing:border-box;border:1px solid #eee;border-radius:4px;padding:4px;text-align:center" placeholder="–∫–≥"></div>`).join('')}</div>
</div><button class="btn-main" id="btnS" onclick="if(confirm('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –∑–∞–ø–∏—Å—å?'))sShip()">–°–û–•–†–ê–ù–ò–¢–¨</button>`;}else if(t=='fas'){const rL=[...gP('WeightStock'), ...gP('Stock_DV')].sort();
ti.innerText='–§–∞—Å–æ–≤–∫–∞';b.innerHTML=`–î–∞—Ç–∞:<input type="date" id="fD" value="${new Date().toISOString().split('T')[0]}">–ö—Ä—É–ø–∞:<select id="fN">${gP('–ì–æ—Ç–æ–≤–∞—è').map(p=>`<option>${p}</option>`).join('')}</select>–°–ø–∏—Å–∞—Ç—å:<select id="fRaw">${rL.map(p=>`<option>${p}</option>`).join('')}</select>–ü–∞–∫–µ—Ç:<select id="fS">${szs.map(s=>`<option>${s}</option>`).join('')}</select><input type="number" id="fP" placeholder="–°—ã—Ä—å–µ –∫–≥"><input type="number" id="fV" placeholder="–í—ã—Ö–æ–¥ —à—Ç"><input type="text" id="fVz" placeholder="–í–∑—è–ª –ø–ª–µ–Ω–∫–∏ (—á–µ—Ä–µ–∑ +)"><input type="number" id="fOs" placeholder="–û—Å—Ç–∞—Ç–æ–∫ –ø–ª–µ–Ω–∫–∏"><button class="btn-main" id="btnS" onclick="if(confirm('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –∑–∞–ø–∏—Å—å?'))sFas()">–°–û–•–†–ê–ù–ò–¢–¨</button>`;}else if(t=='addKrup'){ti.innerText='–ö—Ä—É–ø–æ—Ä—É—à–∫–∞ –û—Ç—á–µ—Ç';
b.innerHTML=`<div style="background:#f9fafb;padding:8px;border-radius:8px;margin-bottom:10px;border:1px solid #eee"><div style="font-size:10px;color:#888;font-weight:700">–û–°–ù–û–í–ù–û–ï –°–´–†–¨–ï (—Å–æ –°–∫–ª–∞–¥–∞)</div><select id="kMainName" onchange="calcKrup()"><option value="">–í—ã–±—Ä–∞—Ç—å...</option>${gP('Stock_Semi').map(s=>`<option value="${s}">${s}</option>`).join('')}</select><div style="display:grid;grid-template-columns:1fr 1fr;gap:5px"><div style="font-size:10px;color:#888;font-weight:700;grid-column:1/-1;margin-top:5px">–î–û–ë–ê–í–ö–ê (—Å–æ –°–∫–ª–∞–¥–∞)</div><select id="kSecName" onchange="calcKrup()"><option value="">–ù–µ—Ç –¥–æ–±–∞–≤–∫–∏</option>${gP('Stock_Semi').map(s=>`<option value="${s}">${s}</option>`).join('')}</select><input type="number" id="kSecW" placeholder="–ö–≥" oninput="calcKrup()"></div></div>–î–∞—Ç–∞:<input type="date" id="kD" value="${new Date().toISOString().split('T')[0]}"><div class="krup-sec">–í—ã—Ö–æ–¥ (–§—Ä–∞–∫—Ü–∏–∏)</div><div class="krup-row">${makeSelect('kN1','Stock_DV','–§—Ä–∞–∫—Ü–∏—è 1')}<input type="number" id="kQ1" placeholder="–ú–µ—à" oninput="calcKrup()"><input type="number" id="kW1" placeholder="–ö–≥" oninput="calcKrup()"></div><div class="krup-row">${makeSelect('kN2','Stock_DV','–§—Ä–∞–∫—Ü–∏—è 2')}<input type="number" id="kQ2" placeholder="–ú–µ—à" oninput="calcKrup()"><input type="number" id="kW2" placeholder="–ö–≥" oninput="calcKrup()"></div><div class="krup-row">${makeSelect('kN3','Stock_DV','–§—Ä–∞–∫—Ü–∏—è 3')}<input type="number" id="kQ3" placeholder="–ú–µ—à" oninput="calcKrup()"><input type="number" id="kW3" placeholder="–ö–≥" oninput="calcKrup()"></div><div class="krup-sec">–û—Ç—Ö–æ–¥—ã</div><div class="krup-row">${makeSelect('kMN','Stock_Feed','–ú—É—á–∫–∞')}<input type="number" id="kMQ" placeholder="–ú–µ—à" oninput="calcKrup()"><input type="number" id="kMW" placeholder="–ö–≥" oninput="calcKrup()"></div><div class="krup-row">${makeSelect('kON','Stock_Feed','–û—Ç—Ä—É–±–∏')}<input type="number" id="kOQ" placeholder="–ú–µ—à" oninput="calcKrup()"><input type="number" id="kOW" placeholder="–ö–≥" oninput="calcKrup()"></div><div style="margin-top:10px;padding:10px;background:#ecfdf5;border:1px solid #10b981;border-radius:8px;text-align:center"><div style="font-size:10px;color:#047857;font-weight:700">–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–û –û–°–ù–û–í–´:</div><input id="kMainW" readonly style="background:transparent;border:none;font-size:20px;font-weight:900;color:#047857;text-align:center;width:100%" value="0"></div><button class="btn-main" id="btnS" onclick="if(confirm('–ó–∞–ø–∏—Å–∞—Ç—å?'))sKrup()">–°–û–•–†–ê–ù–ò–¢–¨</button>`;}else if(t=='addRaw'){ti.innerText='–ü—Ä–∏—Ö–æ–¥ –°—ã—Ä—å—è';b.innerHTML=`–ù–∞–∑–≤–∞–Ω–∏–µ:${makeSelect('rN','Stock_Semi','–ù–∞–∑–≤–∞–Ω–∏–µ')}–ü–æ—Å—Ç–∞–≤—â–∏–∫:${makeSelect('rSupp','','–ü–æ—Å—Ç–∞–≤—â–∏–∫',gS())}–í–µ—Å (–∫–≥):<input type="number" id="rA"><button class="btn-main" id="btnS" onclick="if(confirm('–ü—Ä–∏–Ω—è—Ç—å —Å—ã—Ä—å–µ?'))sRawInc()">–ü–†–ò–ù–Ø–¢–¨</button>`;}else if(t=='addVibro'){ti.innerText='–í–∏–±—Ä–æ—Å—Ç–æ–ª';const dListSemi=`<datalist id="list_Semi">${gP('Stock_Semi').map(x=>`<option value="${x}">`).join('')}</datalist>`;const dListFeed=`<datalist id="list_Feed">${gP('Stock_Feed').map(x=>`<option value="${x}">`).join('')}</datalist>`;b.innerHTML=`${dListSemi}${dListFeed}<div style="background:#f9fafb;padding:8px;border-radius:8px;margin-bottom:10px;border:1px solid #eee"><div style="font-size:10px;color:#888;font-weight:700">–û–°–ù–û–í–ù–û–ï –°–´–†–¨–ï</div><select id="vMain" onchange="calcVibro()"><option value="">–í—ã–±—Ä–∞—Ç—å...</option>${gP('Stock_Semi').map(s=>`<option value="${s}">${s}</option>`).join('')}</select><div style="display:grid;grid-template-columns:1fr 1fr;gap:5px"><div style="font-size:10px;color:#888;font-weight:700;grid-column:1/-1;margin-top:5px">–î–û–ë–ê–í–ö–ê</div><select id="vSecName" onchange="calcVibro()"><option value="">–ù–µ—Ç</option>${gP('Stock_Semi').map(s=>`<option value="${s}">${s}</option>`).join('')}</select><input type="number" id="vSecW" placeholder="–ö–≥" oninput="calcVibro()"></div></div>–î–∞—Ç–∞:<input type="date" id="vD" value="${new Date().toISOString().split('T')[0]}"><div class="krup-sec">–í—ã—Ö–æ–¥</div><div class="krup-row">${makeSelect('vN1','Stock_Semi','–§—Ä–∞–∫—Ü–∏—è 1')}<input type="number" id="vQ1" placeholder="–ú–µ—à" oninput="calcVibro()"><input type="number" id="vW1" placeholder="–ö–≥" oninput="calcVibro()"></div><div class="krup-row">${makeSelect('vN2','Stock_Feed','–§—Ä–∞–∫—Ü–∏—è 2')}<input type="number" id="vQ2" placeholder="–ú–µ—à" oninput="calcVibro()"><input type="number" id="vW2" placeholder="–ö–≥" oninput="calcVibro()"></div><div class="krup-row">${makeSelect('vN3','Stock_Feed','–§—Ä–∞–∫—Ü–∏—è 3')}<input type="number" id="vQ3" placeholder="–ú–µ—à" oninput="calcVibro()"><input type="number" id="vW3" placeholder="–ö–≥" oninput="calcVibro()"></div><div style="margin-top:10px;padding:10px;background:#ecfdf5;border:1px solid #10b981;border-radius:8px;text-align:center"><div style="font-size:10px;color:#047857;font-weight:700">–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–û –û–°–ù–û–í–´:</div><input id="vRawW" readonly style="background:transparent;border:none;font-size:20px;font-weight:900;color:#047857;text-align:center;width:100%" value="0"></div><button class="btn-main" id="btnS" onclick="if(confirm('–ó–∞–ø–∏—Å–∞—Ç—å?'))sVibro()">–°–û–•–†–ê–ù–ò–¢–¨</button>`;}else if(t=='addZSHM'){ti.innerText='–ó–®–ú –°–º–µ–Ω–∞';b.innerHTML=`<div style="background:#f9fafb;padding:8px;border-radius:8px;margin-bottom:10px;border:1px solid #eee"><div style="font-size:10px;color:#888;font-weight:700">–û–°–ù–û–í–ù–û–ï –°–´–†–¨–ï</div><select id="zMain" onchange="calcZSHM()"><option value="">–í—ã–±—Ä–∞—Ç—å...</option>${gP('Stock_Semi').map(s=>`<option value="${s}">${s}</option>`).join('')}</select><div style="display:grid;grid-template-columns:1fr 1fr;gap:5px"><div style="font-size:10px;color:#888;font-weight:700;grid-column:1/-1;margin-top:5px">–î–û–ë–ê–í–ö–ê</div><select id="zSecName" onchange="calcZSHM()"><option value="">–ù–µ—Ç</option>${gP('Stock_Semi').map(s=>`<option value="${s}">${s}</option>`).join('')}</select><input type="number" id="zSecW" placeholder="–ö–≥" oninput="calcZSHM()"></div></div>–î–∞—Ç–∞:<input type="date" id="zD" value="${new Date().toISOString().split('T')[0]}"><div class="krup-sec">–í—ã—Ö–æ–¥ –ü—Ä–æ–¥—É–∫—Ç–∞</div><div class="krup-row">${makeSelect('zN_Prod','Stock_DV','–ü—Ä–æ–¥—É–∫—Ç')}<input type="number" id="zQ_Prod" placeholder="–ú–µ—à" oninput="calcZSHM()"><input type="number" id="zW_Prod" placeholder="–ö–≥" oninput="calcZSHM()"></div><div class="krup-sec">–û—Ç—Ö–æ–¥—ã</div><div class="krup-row">${makeSelect('zN_Sech','Stock_Semi','–°–µ—á–∫–∞')}<input type="number" id="zQ_Sech" placeholder="–ú–µ—à" oninput="calcZSHM()"><input type="number" id="zW_Sech" placeholder="–ö–≥" oninput="calcZSHM()"></div><div class="krup-row">${makeSelect('zN_Much','Stock_Feed','–ú—É—á–∫–∞')}<input type="number" id="zQ_Much" placeholder="–ú–µ—à" oninput="calcZSHM()"><input type="number" id="zW_Much" placeholder="–ö–≥" oninput="calcZSHM()"></div><div class="krup-row">${makeSelect('zN_Otr','Stock_Feed','–û—Ç—Ä—É–±–∏')}<input type="number" id="zQ_Otr" placeholder="–ú–µ—à" oninput="calcZSHM()"><input type="number" id="zW_Otr" placeholder="–ö–≥" oninput="calcZSHM()"></div><div style="margin-top:10px;padding:10px;background:#ecfdf5;border:1px solid #10b981;border-radius:8px;text-align:center"><div style="font-size:10px;color:#047857;font-weight:700">–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–û –û–°–ù–û–í–´:</div><input id="zRawW" readonly style="background:transparent;border:none;font-size:20px;font-weight:900;color:#047857;text-align:center;width:100%" value="0"></div><button class="btn-main" id="btnS" onclick="if(confirm('–ó–∞–ø–∏—Å–∞—Ç—å —Å–º–µ–Ω—É –ó–®–ú?'))sZSHM()">–°–û–•–†–ê–ù–ò–¢–¨</button>`;}else if(t=='corr'){const [cat,name]=id.split('|');ti.innerText='–ö–æ—Ä—Ä–µ–∫—Ü–∏—è: '+name;b.innerHTML=`–î–∞—Ç–∞:<input type="date" id="cD" value="${new Date().toISOString().split('T')[0]}">–ö–æ–ª-–≤–æ:<input type="number" id="cA">–ü—Ä–∏—á–∏–Ω–∞:<input type="text" id="cR"><button class="btn-main" id="btnS" onclick="if(confirm('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –∑–∞–ø–∏—Å—å?'))sCorr('${cat}','${name}')">–û–ö</button>`;}else if(t=='vInv'){const [rid,key]=id.split('|'),v=data[key][rid];ti.innerText='–ù–∞–∫–ª–∞–¥–Ω–∞—è';b.innerHTML=`<b>${v.client||v.supplier}</b> (${fd(v.date)})<br>‚Ññ ${v.num||'–ë/–ù'}<hr><div style="font-size:12px">${v.items?v.items.join('<br>'):(v.name+': '+v.amount)}</div><button class="btn-main" style="background:var(--d);margin-top:15px" onclick="delArchRec('${key}','${rid}')">–£–î–ê–õ–ò–¢–¨ –° –í–û–ó–í–†–ê–¢–û–ú</button>`;}document.getElementById('mdl').style.display='flex';}
async function login(){try{await auth.signInWithEmailAndPassword(document.getElementById('lE').value,document.getElementById('lP').value);closeModal()}catch(e){alert('–û—à–∏–±–∫–∞')}}
auth.onAuthStateChanged(u=>{document.getElementById('uS').innerText=u?u.email.toUpperCase():"–í–•–û–î...";renderHome()});window.onload=renderHome;
</script></body></html>
