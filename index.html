<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>–°–∫–ª–∞–¥ v149</title><link rel="icon" type="image/png" href="https://i.ibb.co/Lz8ky3YJ/file-00000000ff1471f4b6d9f9d2c686ef67.png"><link rel="apple-touch-icon" href="https://i.ibb.co/Lz8ky3YJ/file-00000000ff1471f4b6d9f9d2c686ef67.png"><style>
:root{--bg:#f4f7f9;--card:#fff;--primary:#5c67f2;--success:#27ae60;--danger:#eb5757;--text:#2c3e50;--sub:#95a5a6;--warning:#f2994a}body{font-family:-apple-system,system-ui,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:10px;padding-bottom:40px}.dash-grid{display:flex;flex-direction:column;gap:10px;max-width:500px;margin:0 auto}.dash-item{background:#fff;border-radius:15px;padding:18px;text-align:center;box-shadow:0 4px 10px rgba(0,0,0,.05);cursor:pointer;border:1px solid #eee;font-weight:700;font-size:16px}.menu-nav{display:none;grid-template-columns:repeat(6,1fr) 35px;gap:2px;margin-bottom:10px;position:sticky;top:0;background:var(--bg);padding:5px 0;z-index:100}body.nav-active .menu-nav{display:grid}.btn-cat{border:none;border-radius:6px;padding:8px 1px;font-weight:700;font-size:8px;background:var(--card);color:var(--sub)}.btn-cat.active{background:var(--primary);color:#fff}.card{background:var(--card);border-radius:15px;padding:12px;margin-bottom:8px;box-shadow:0 2px 5px rgba(0,0,0,.05)}.row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #f8f9fa;font-size:15px}.qty-alarm{color:#ff0000!important;animation:blink .8s infinite;font-weight:900!important;text-shadow:0 0 5px rgba(255,0,0,.3)}@keyframes blink{50%{opacity:.2}}.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(3px);z-index:1000;align-items:center;justify-content:center;padding:10px}.modal-box{background:#fff;width:100%;max-width:420px;border-radius:20px;max-height:85vh;display:flex;flex-direction:column}.modal-body{overflow-y:auto;padding:0 15px 15px}input,select{width:100%;padding:12px;margin:5px 0;border:1.5px solid #eee;border-radius:10px;font-size:16px;box-sizing:border-box}.btn-main{background:var(--primary);color:#fff;border:none;width:100%;padding:14px;font-size:15px;font-weight:700;border-radius:12px;margin:5px 0;cursor:pointer}.admin-only{display:none!important}body.auth-ok .admin-only{display:block!important}.inv-items{display:none;margin-top:10px;padding-top:10px;border-top:1px dashed #eee;color:var(--danger);font-size:13px}.inv-card.open .inv-items{display:block}.month-group{background:#eef1f4;padding:10px;border-radius:12px;margin-bottom:10px;font-weight:bold;color:#64748b;cursor:pointer;display:flex;justify-content:space-between}.month-content{display:none}.month-content.open{display:block}.beta-banner{background:#eb5757;color:#fff;padding:10px;text-align:center;font-size:13px;border-radius:10px;margin-bottom:15px;font-weight:900;animation:warn-blink 1s infinite;border:2px solid #fff;box-shadow:0 0 10px rgba(235,87,87,0.5)}@keyframes warn-blink{0%,100%{background:#eb5757}50%{background:#b33a3a}}
</style></head><body id="app"><div id="userStatus" style="font-size:10px;text-align:center;color:var(--sub);margin-bottom:10px">–ó–∞–≥—Ä—É–∑–∫–∞...</div><div class="menu-nav" id="mainMenu"><button class="btn-cat" onclick="setCat('–ì–æ—Ç–æ–≤–∞—è')">–°–∫–ª–∞–¥</button><button class="btn-cat" onclick="setCat('–§–∞—Å–æ–≤–∫–∞')">–§–∞—Å–æ–≤–∫–∞</button><button class="btn-cat" onclick="setCat('–ü–ª–µ–Ω–∫–∞')">–ü–ª–µ–Ω–∫–∞</button><button class="btn-cat" onclick="setCat('–ü–∞–∫–µ—Ç—ã')">–ü–∞–∫–µ—Ç—ã</button><button class="btn-cat" onclick="setCat('–°–∫–æ—Ç—á')">–°–∫–æ—Ç—á</button><button class="btn-cat" onclick="setCat('Invoices')">–ê—Ä—Ö–∏–≤</button><button class="btn-cat" onclick="openModal('auth')">‚öôÔ∏è</button></div><div id="actions" class="admin-only"></div><div id="content"></div><div id="modal" class="modal"><div class="modal-box"><div class="modal-header" style="display:flex;justify-content:space-between;padding:15px;border-bottom:1px solid #eee"><h4 id="modalTitle" style="margin:0"></h4><button onclick="closeModal()" style="border:none;background:none;font-size:24px">‚úï</button></div><div id="modalBody" class="modal-body"></div></div></div><script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script><script>
const config={apiKey:"AIzaSyAya0CSXtG3Fh4GzJ2bV7AJ0BaYEcTXK9Q",databaseURL:"https://myproductionapp-bd872-default-rtdb.firebaseio.com",projectId:"myproductionapp-bd872"};
if(!firebase.apps.length)firebase.initializeApp(config);const db=firebase.database(),auth=firebase.auth();let currentCat='Home',isAdmin=false,currentUserEmail='',cachedData={},activeId=null,originalTime=null;
const products=["–ê—Ä–Ω–∞—É—Ç–∫–∞","–ê—Ä—Ç–µ–∫","–Ø—á–∫–∞","–ü—à–µ–Ω–∏—á–∫–∞","–ö—É–∫—É—Ä—É–∑–∞","–ì–æ—Ä–æ—Ö","–ú–∞–Ω–∫–∞","–•–ª–æ–ø—å—è","–ì—Ä–µ—á–∫–∞","–†–∏—Å –¥–ª","–†–∏—Å –∫—Ä","–†–∏—Å –ø—Ä","–ü–µ—Ä–ª–æ–≤–∫–∞","–ü—à–æ–Ω–æ","–ö—É–∫.–º—É–∫–∞","–ë–∞—Å–º–∞—Ç–∏ –≥","–ë–∞—Å–º–∞—Ç–∏ –∫","–ö—É—Ç—è","–ö—É—Å –∫—É—Å","–ù—É—Ç","–ß–µ—á–µ–≤–∏—Ü–∞","–ë—É–ª–≥—É—Ä"],sizes=["300√ó400","370√ó500","400√ó500","420√ó550"],months=["–Ø–Ω–≤–∞—Ä—å","–§–µ–≤—Ä–∞–ª—å","–ú–∞—Ä—Ç","–ê–ø—Ä–µ–ª—å","–ú–∞–π","–ò—é–Ω—å","–ò—é–ª—å","–ê–≤–≥—É—Å—Ç","–°–µ–Ω—Ç—è–±—Ä—å","–û–∫—Ç—è–±—Ä—å","–ù–æ—è–±—Ä—å","–î–µ–∫–∞–±—Ä—å"];
auth.onAuthStateChanged(user=>{isAdmin=!!user;currentUserEmail=user?user.email:'';document.body.classList.toggle('auth-ok',isAdmin);document.getElementById('userStatus').innerText=user?"–í—Ö–æ–¥: "+user.email:"–í—Ö–æ–¥ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω";if(currentCat==='Home')renderHome()});
function fd(i){if(!i)return'';const d=i.split('T')[0].split('-');return d.length===3?`${d[2]}.${d[1]}.${d[0]}`:i}
function renderHome(){currentCat='Home';document.body.classList.remove('nav-active');document.getElementById('actions').innerHTML='';document.getElementById('content').innerHTML=`<div class="dash-grid"><div class="dash-item" onclick="setCat('–ì–æ—Ç–æ–≤–∞—è')" style="border-left:5px solid var(--primary)">üì¶ –°–∫–ª–∞–¥ –≥–æ—Ç–æ–≤–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏</div><div class="dash-item" onclick="setCat('–§–∞—Å–æ–≤–∫–∞')" style="border-left:5px solid var(--success)">üöú –§–∞—Å–æ–≤–∫–∞</div><div class="dash-item" onclick="setCat('–ü–ª–µ–Ω–∫–∞')" style="border-left:5px solid #f2994a">üéûÔ∏è –ü–ª–µ–Ω–∫–∞</div><div class="dash-item" onclick="setCat('–ü–∞–∫–µ—Ç—ã')" style="border-left:5px solid #9b51e0">üõçÔ∏è –ü–∞–∫–µ—Ç—ã</div><div class="dash-item" onclick="setCat('–°–∫–æ—Ç—á')" style="border-left:5px solid #2d9cdb">üéóÔ∏è –°–∫–æ—Ç—á</div><div class="dash-item" onclick="setCat('Invoices')" style="border-left:5px solid #64748b">üìÑ –ê—Ä—Ö–∏–≤ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö</div><div class="dash-item" onclick="openModal('auth')" style="background:#64748b;color:white">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div></div>`}
function setCat(c){currentCat=c;document.body.classList.add('nav-active');const a=document.getElementById('actions');a.innerHTML=`<button class="btn-main" style="background:#64748b" onclick="renderHome()">‚¨Ö –ì–õ–ê–í–ù–ê–Ø</button>`;if(c==='–§–∞—Å–æ–≤–∫–∞')a.innerHTML+=`<button class="btn-main" onclick="openModal('fasovka')">+ –ù–æ–≤–∞—è —Ñ–∞—Å–æ–≤–∫–∞</button>`;else if(c==='–ì–æ—Ç–æ–≤–∞—è')a.innerHTML+=`<button class="btn-main" style="background:var(--danger)" onclick="openModal('shipment')">- –û—Ç–≥—Ä—É–∑–∫–∞</button>`;else if(c!=='Invoices')a.innerHTML+=`<button class="btn-main" onclick="openModal('add')">+ –ü—Ä–∏—Ö–æ–¥</button>`;loadData()}
function loadData(){db.ref('inventory').on('value',s=>{cachedData=s.val()||{};const c=document.getElementById('content');if(c){if(currentCat==='Invoices')renderInvoices(c);else if(currentCat==='–§–∞—Å–æ–≤–∫–∞')renderFasList(c);else if(currentCat==='–ì–æ—Ç–æ–≤–∞—è')renderWarehouseGrid(c);else if(currentCat!=='Home')renderGenericStock(c)}})}
function fmt(c,v){return(c==='–ü–∞–∫–µ—Ç—ã'||c==='–ì–æ—Ç–æ–≤–∞—è')?Math.round(v).toString():v.toFixed(1)}
function renderGenericStock(c){const d=cachedData[currentCat]||{},t={};Object.values(d).forEach(v=>{if(v.size)t[v.size]=(t[v.size]||0)+v.amount});let h='<div class="card">';Object.keys(t).sort().forEach(k=>{const a=t[k],al=(currentCat==='–ü–∞–∫–µ—Ç—ã'&&a<3000)||(currentCat==='–ü–ª–µ–Ω–∫–∞'&&a<50)||(currentCat==='–°–∫–æ—Ç—á'&&a<30);h+=`<div class="row"><b>${k}</b><div style="display:flex;align-items:center"><span class="${al?'qty-alarm':''}" style="font-weight:800;color:var(--primary)" onclick="isAdmin&&openModal('edit','${k}',${a})">${fmt(currentCat,a)}</span><button style="border:none;background:none;margin-left:10px" onclick="showHist('${currentCat}','${k}')">üìñ</button></div></div>`});c.innerHTML=h+'</div>'}
function renderWarehouseGrid(c){const d=cachedData.–ì–æ—Ç–æ–≤–∞—è||{},t={};products.forEach(p=>t[p]=0);Object.values(d).forEach(v=>{if(t[v.name]!==undefined)t[v.name]+=v.amount});let h='<div class="beta-banner">–†–ï–ñ–ò–ú –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø</div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px">';Object.keys(t).sort().forEach(n=>{h+=`<div class="card" style="text-align:center;padding:10px;margin:0"><b style="font-size:10px;display:block;height:24px">${n}</b><span style="color:var(--primary);font-weight:800;cursor:pointer" onclick="isAdmin&&openModal('edit','${n}',${t[n]})">${fmt('–ì–æ—Ç–æ–≤–∞—è',t[n])}</span><br><button style="border:none;background:none;margin-top:5px" onclick="showHist('–ì–æ—Ç–æ–≤–∞—è','${n}')">üìñ</button></div>`});c.innerHTML=h+'</div>'}
function renderFasList(c){let h='';Object.entries(cachedData.–§–∞—Å–æ–≤–∫–∞||{}).sort((a,b)=>b[1].date.localeCompare(a[1].date)).forEach(([id,v])=>{const b=Math.round(v.vyhod*.103),f=(parseFloat(v.vzial||0)-parseFloat(v.ostatok||0)).toFixed(1);h+=`<div class="card" onclick="editFasovka('${id}')"><b>${v.name}</b> (${fd(v.date)})<br>${v.prihod}–∫–≥ ‚Üí <span style="color:var(--primary);font-weight:bold">${v.vyhod}—à—Ç</span><div style="font-size:10px;color:var(--sub);margin-top:5px;line-height:1.4">üõçÔ∏è –ü–∞–∫–µ—Ç—ã: ${v.size} (${b} —à—Ç)<br>üéûÔ∏è –ü–ª–µ–Ω–∫–∞: ${f} –∫–≥<br>üë§ –ê–≤—Ç–æ—Ä: ${v.author||'–Ω/–¥'}</div></div>`});c.innerHTML=h||'–ü—É—Å—Ç–æ'}
function renderInvoices(c){const d=cachedData.ArchInvoices||{};const groups={};Object.entries(d).forEach(([id,v])=>{const date=new Date(v.date);const key=`${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}`;if(!groups[key])groups[key]=[];groups[key].push({...v,id});});let h='<div class="beta-banner">–†–ï–ñ–ò–ú –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø</div>';Object.keys(groups).sort().reverse().forEach(key=>{const [y,m]=key.split('-');const mName=months[parseInt(m)-1];h+=`<div class="month-group" onclick="this.nextElementSibling.classList.toggle('open')">üìÇ ${mName} ${y} <span>${groups[key].length}</span></div><div class="month-content">`;groups[key].sort((a,b)=>b.date.localeCompare(a.date)).forEach(v=>{h+=`<div class="card inv-card" onclick="this.classList.toggle('open')"><div style="display:flex;justify-content:space-between;align-items:center"><div><small style="color:var(--sub)">${fd(v.date)}</small><br><b>‚Ññ${v.num}</b> ‚Äî ${v.client}</div><span style="font-size:12px;color:var(--primary)">‚ñº</span></div><div class="inv-items"><b>–°–æ—Å—Ç–∞–≤:</b><br>${v.items.join('<br>')}</div>${isAdmin?`<button style="color:red;border:none;background:none;width:100%;text-align:right;font-size:10px;margin-top:10px" onclick="event.stopPropagation();confirmOp(()=>db.ref('inventory/ArchInvoices/'+'${v.id}').remove())">–£–¥–∞–ª–∏—Ç—å</button>`:''}</div>`});h+=`</div>`});c.innerHTML=h||'–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç'}
function editFasovka(id){if(!isAdmin)return;activeId=id;const v=cachedData.–§–∞—Å–æ–≤–∫–∞[id];originalTime=v.date.split('T')[1];openModal('fasovka');setTimeout(()=>{document.getElementById('fDate').value=v.date.split('T')[0];document.getElementById('fName').value=v.name;document.getElementById('fSize').value=v.size;document.getElementById('fPr').value=v.prihod;document.getElementById('fVy').value=v.vyhod;document.getElementById('fVzial').value=v.vzial;document.getElementById('fOs').value=v.ostatok},50)}
function openModal(t,n,v,logId){const ti=document.getElementById('modalTitle'),b=document.getElementById('modalBody');if(t==='auth'){ti.innerText='–í—Ö–æ–¥';b.innerHTML=`<input type="email" id="lEmail" value="nukonor@gmail.com"><input type="password" id="lPass" placeholder="–ü–∞—Ä–æ–ª—å"><button class="btn-main" onclick="login()">–í–æ–π—Ç–∏</button>${isAdmin?`<button class="btn-main" style="background:var(--danger)" onclick="auth.signOut();closeModal();renderHome()">–í—ã—Ö–æ–¥</button>`:''}`}
else if(t==='edit'){ti.innerText='–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞: '+n;b.innerHTML=`<label style="font-size:12px">–î–∞—Ç–∞ –æ—Å—Ç–∞—Ç–∫–∞:</label><input type="date" id="editDate" value="${new Date().toISOString().split('T')[0]}"><label style="font-size:12px">–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫ —Å–µ–π—á–∞—Å:</label><input type="number" id="nQty" value="${fmt(currentCat,v)}"><button class="btn-main" onclick="confirmOp(()=>saveEdit('${n}',${v}))">–û–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞—Ç–æ–∫</button>`}
else if(t==='editLog'){ti.innerText='–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å';b.innerHTML=`<input type="number" id="editLogVal" value="${v}"><button class="btn-main" onclick="confirmOp(()=>saveLogChange('${currentCat}','${logId}'))">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>`}
else if(t==='fasovka'){ti.innerText='–§–∞—Å–æ–≤–∫–∞';b.innerHTML=`<input type="date" id="fDate" value="${new Date().toISOString().split('T')[0]}"><select id="fName">${products.map(p=>`<option>${p}</option>`).join('')}</select><select id="fSize">${sizes.map(s=>`<option>${s}</option>`).join('')}</select><input type="number" id="fPr" placeholder="–°—ã—Ä—å–µ –∫–≥"><input type="number" id="fVy" placeholder="–í—ã—Ö–æ–¥ —à—Ç"><input type="number" id="fVzial" placeholder="–í–∑—è–ª –ø–ª–µ–Ω–∫–∏" step="0.1"><input type="number" id="fOs" placeholder="–û—Å—Ç–∞—Ç–æ–∫ –ø–ª–µ–Ω–∫–∏" step="0.1"><button class="btn-main" onclick="confirmOp(saveFas)">${activeId?'–û–±–Ω–æ–≤–∏—Ç—å':'–ó–∞–ø–∏—Å–∞—Ç—å'}</button>${activeId?`<button class="btn-main" style="background:var(--danger)" onclick="confirmOp(deleteFasActual)">–£–î–ê–õ–ò–¢–¨</button>`:''}`}
else if(t==='shipment'){ti.innerText='–û—Ç–≥—Ä—É–∑–∫–∞';let h=`<input type="date" id="sDate" value="${new Date().toISOString().split('T')[0]}"><input type="text" id="sNum" placeholder="–ù–æ–º–µ—Ä –Ω–∞–∫–ª–∞–¥–Ω–æ–π"><input type="text" id="sCl" placeholder="–ö–æ–º—É">`;products.sort().forEach(p=>{h+=`<div style="display:grid;grid-template-columns:1fr 80px;align-items:center;border-bottom:1px solid #eee"><label style="font-size:12px">${p}</label><input type="number" class="s-in" data-p="${p}" placeholder="0" style="margin:0;padding:5px"></div>`});h+=`<button class="btn-main" style="background:var(--danger)" onclick="confirmOp(saveShip)">–ó–∞–ø–∏—Å–∞—Ç—å –æ—Ç–≥—Ä—É–∑–∫—É</button>`;b.innerHTML=h}
else if(t==='add'){ti.innerText='–ü—Ä–∏—Ö–æ–¥';b.innerHTML=`<input type="date" id="aDate" value="${new Date().toISOString().split('T')[0]}"><select id="aSize">${(currentCat==='–ü–ª–µ–Ω–∫–∞'?products:(currentCat==='–ü–∞–∫–µ—Ç—ã'?sizes:['–°–∫–æ—Ç—á 360–≥'])).map(s=>`<option>${s}</option>`).join('')}</select><input type="number" id="aAmt" placeholder="–ö–æ–ª-–≤–æ"><button class="btn-main" onclick="confirmOp(saveAdd)">–ó–∞–ø–∏—Å–∞—Ç—å</button>`}
document.getElementById('modal').style.display='flex'}
function confirmOp(f){if(confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã?"))f()}
async function saveEdit(n,o){const v=parseFloat(document.getElementById('nQty').value),d=document.getElementById('editDate').value;await db.ref(`inventory/${currentCat}`).push({size:n,name:n,amount:v-o,date:d+"T00:00:00Z",note:'–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ (–Ω–∞—á. –æ—Å—Ç.)',author:currentUserEmail});closeModal()}
async function saveLogChange(cat,id){const v=parseFloat(document.getElementById('editLogVal').value);await db.ref(`inventory/${cat}/${id}`).update({amount:v});closeModal();setTimeout(()=>showHist(cat, cachedData[cat][id].size || cachedData[cat][id].name),200);}
async function deleteEntry(c,i){await db.ref(`inventory/${c}/${i}`).remove();closeModal();setTimeout(()=>loadData(),200);}
function showHist(c,k){const ti=document.getElementById('modalTitle'),b=document.getElementById('modalBody');ti.innerText=k;const l=Object.entries(cachedData[c]||{}).map(([id,v])=>({...v,id})).filter(v=>v.size===k||v.name===k).sort((x,y)=>{let tx=new Date(x.date).getTime();let ty=new Date(y.date).getTime();if(tx!==ty)return ty-tx;return y.id.localeCompare(x.id);});let h='<table style="width:100%;font-size:11px"><tr><th>–î–∞—Ç–∞</th><th>–ò–Ω—Ñ–æ/–ê–≤—Ç–æ—Ä</th><th>–ö–æ–ª</th><th></th></tr>';l.forEach(v=>{const isSys=v.author==='–°–∏—Å—Ç–µ–º–∞ (–ê–≤—Ç–æ)';h+=`<tr style="border-bottom:1px solid #eee"><td>${fd(v.date)}</td><td>${v.note||''}<br><small style="color:${isSys?'#27ae60':'var(--sub)'}">${v.author||'–Ω/–¥'}</small></td><td style="color:${v.amount>0?'green':'red'};cursor:pointer" onclick="isAdmin&&openModal('editLog','${k}',${v.amount},'${v.id}')">${fmt(c,v.amount)}</td><td>${isAdmin?`<button style="color:red;border:none;background:none;font-size:16px" onclick="event.stopPropagation();confirmOp(()=>deleteEntry('${c}','${v.id}'))">‚úï</button>`:''}</td></tr>`});b.innerHTML=h+'</table>';document.getElementById('modal').style.display='flex'}
async function saveFas(){const d=document.getElementById('fDate').value,na=document.getElementById('fName').value,si=document.getElementById('fSize').value,vy=parseFloat(document.getElementById('fVy').value)||0,vz=parseFloat(document.getElementById('fVzial').value)||0,os=parseFloat(document.getElementById('fOs').value)||0,pr=document.getElementById('fPr').value;if(activeId){for(let c of['–ü–∞–∫–µ—Ç—ã','–ü–ª–µ–Ω–∫–∞','–°–∫–æ—Ç—á','–ì–æ—Ç–æ–≤–∞—è']){const s=await db.ref('inventory/'+c).once('value');s.forEach(h=>{if(h.val().linkedId===activeId)h.ref.remove()})}}const nI=activeId||db.ref('inventory/–§–∞—Å–æ–≤–∫–∞').push().key,ts=new Date().toISOString().split('T')[1],dt=d+"T"+(activeId?originalTime:ts);await db.ref('inventory/–§–∞—Å–æ–≤–∫–∞/'+nI).set({date:dt,name:na,size:si,vyhod:vy,vzial:vz,ostatok:os,prihod:pr,author:currentUserEmail});if(vy>0){const t=parseFloat(((vy*.12)/360).toFixed(1)),b=Math.round(vy*.103);await db.ref('inventory/–ü–∞–∫–µ—Ç—ã').push({size:si,amount:-b,date:dt,linkedId:nI,note:'–§–∞—Å–æ–≤–∫–∞:'+na,author:'–°–∏—Å—Ç–µ–º–∞ (–ê–≤—Ç–æ)'});await db.ref('inventory/–°–∫–æ—Ç—á').push({size:'–°–∫–æ—Ç—á 360–≥',amount:-t,date:dt,linkedId:nI,note:'–§–∞—Å–æ–≤–∫–∞:'+na,author:'–°–∏—Å—Ç–µ–º–∞ (Aut–æ)'});await db.ref('inventory/–ì–æ—Ç–æ–≤–∞—è').push({name:na,amount:vy,date:dt,linkedId:nI,note:'–ü—Ä-–≤–æ: –°–º–µ–Ω–∞',author:'–°–∏—Å—Ç–µ–º–∞ (–ê–≤—Ç–æ)'})}if(vz-os!==0)await db.ref('inventory/–ü–ª–µ–Ω–∫–∞').push({size:na,amount:-(vz-os),date:dt,linkedId:nI,note:'–§–∞—Å–æ–≤–∫–∞',author:'–°–∏—Å—Ç–µ–º–∞ (–ê–≤—Ç–æ)'});closeModal()}
async function saveShip(){const d=document.getElementById('sDate').value,nu=document.getElementById('sNum').value,cl=document.getElementById('sCl').value,ts=new Date().toISOString().split('T')[1];if(!cl||!nu)return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ ‚Ññ –Ω–∞–∫–ª–∞–¥–Ω–æ–π –∏ –ö–æ–º—É!");let items=[];const inputs=document.querySelectorAll('.s-in');for(let i of inputs){const a=parseFloat(i.value);if(a>0){await db.ref('inventory/–ì–æ—Ç–æ–≤–∞—è').push({name:i.dataset.p,amount:-a,date:d+"T"+ts,note:'–û—Ç–≥—Ä—É–∑–∫–∞: '+cl+' (‚Ññ'+nu+')',author:currentUserEmail});items.push(i.dataset.p+' ‚Äî '+a+' —à—Ç');}}if(items.length>0)await db.ref('inventory/ArchInvoices').push({date:d+"T"+ts,num:nu,client:cl,items:items,author:currentUserEmail});closeModal()}
async function deleteFasActual(){for(let c of['–ü–∞–∫–µ—Ç—ã','–ü–ª–µ–Ω–∫–∞','–°–∫–æ—Ç—á','–ì–æ—Ç–æ–≤–∞—è']){const s=await db.ref('inventory/'+c).once('value');s.forEach(h=>{if(h.val().linkedId===activeId)h.ref.remove()})}await db.ref('inventory/–§–∞—Å–æ–≤–∫–∞/'+activeId).remove();closeModal()}
async function saveAdd(){const s=document.getElementById('aSize').value,a=parseFloat(document.getElementById('aAmt').value),d=document.getElementById('aDate').value,ts=new Date().toISOString().split('T')[1];if(a)await db.ref(`inventory/${currentCat}`).push({size:s,amount:a,date:d+"T"+ts,note:'–ü—Ä–∏—Ö–æ–¥',author:currentUserEmail});closeModal()}
async function login(){try{await auth.signInWithEmailAndPassword(document.getElementById('lEmail').value,document.getElementById('lPass').value);closeModal()}catch(e){alert(e.message)}}
function closeModal(){document.getElementById('modal').style.display='none';activeId=null}window.onload=renderHome;
</script></body></html>
